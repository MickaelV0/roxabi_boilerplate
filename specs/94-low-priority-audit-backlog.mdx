---
title: "Low-Priority Audit Backlog"
description: Address remaining low-priority findings from the 2026-02-09 project audit across security, documentation, maintenance, and code quality.
status: planned
---

## Context

The [project audit of 2026-02-09](../analyses/project-audit-2026-02-09) identified 62 findings across 6 domains. Critical, high, and medium items have been addressed or tracked in separate issues (#89 security hardening, #92 docs remediation, #53 rate limiting). This spec covers the **11 remaining low-priority items** still open in issue #94.

**Promoted from:** [Project Audit — Full Health Check](../analyses/project-audit-2026-02-09)

## Goal

Close all remaining low-priority audit findings in a single sweep, improving security posture, documentation completeness, and maintenance hygiene without architectural changes.

## Users &amp; Use Cases

| User | Benefit |
|------|---------|
| **New contributors** | Accurate docs (index pages, lefthook guide, troubleshooting) reduce onboarding friction |
| **DevOps / deployers** | Env vars in docker-compose prevent accidental credential exposure |
| **Maintainers** | Standardized versions and deduplicated deps reduce upgrade burden |
| **CI pipeline** | Consistent test scripts improve cache efficiency |

## Expected Behavior

### L-1: Use env vars in docker-compose.yml

**Current state:** Hardcoded `POSTGRES_USER: roxabi`, `POSTGRES_PASSWORD: roxabi`, `POSTGRES_DB: roxabi` at lines 9-11.

**Target:** Read from environment with safe defaults for local dev:

```yaml
environment:
  POSTGRES_USER: ${POSTGRES_USER:-roxabi}
  POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-roxabi}
  POSTGRES_DB: ${POSTGRES_DB:-roxabi}
```

Also update the `healthcheck` command to use `${POSTGRES_USER:-roxabi}`.

### L-4: Track nitro stable release

**Current state:** `apps/web/package.json` pins `"nitro": "^3.0.1-alpha.2"`.

**Target:** Check if a stable nitro v3 release exists. If yes, upgrade. If not, add a comment in `package.json` and keep the alpha pin. Either way, document the decision.

### L-6: Update specs/analyses index pages

**Current state:**
- `specs/index.mdx` lists only 1 spec ("Documentation Server") but 18 specs exist.
- `analyses/index.mdx` lists only the original 6 infrastructure analyses but 20+ analyses exist.

**Target:** Regenerate both index pages to list all current documents, grouped by category. Use the existing `meta.json` files as the source of truth for which files exist.

### L-8: Document lefthook git hooks

**Current state:** `docs/hooks.mdx` only covers Claude Code hooks (Biome auto-format, security check). Lefthook is configured in `lefthook.yml` with 3 hook stages (commit-msg, pre-commit, pre-push) but is undocumented.

**Target:** Add a "Git Hooks (Lefthook)" section to `docs/hooks.mdx` documenting:
- `commit-msg`: commitlint validation
- `pre-commit`: Biome check with `stage_fixed: true`
- `pre-push`: lint + typecheck + test:coverage (parallel)
- How to install (`lefthook install`) and skip (`--no-verify`)

### L-10: Troubleshooting guide

**Current state:** No dedicated troubleshooting page. Only a small note exists elsewhere.

**Target:** Create `docs/guides/troubleshooting.mdx` with common issues:
- Database connection failures (Docker not running, wrong port)
- Bun version mismatch
- Port already in use
- Pre-commit hook failures
- TypeScript build errors after dependency updates
- Turbo cache staleness

Keep it concise — 1-3 sentences per issue with the fix command.

### L-11: Standardize TypeScript versions

**Current state:**
| Package | Version |
|---------|---------|
| Root `package.json` | `^5.9.3` |
| `packages/config` | `^5.7.0` |
| `packages/types` | `^5.7.0` |
| `packages/ui` | `^5.7.0` |

**Target:** Align all packages to the root version (`^5.9.3`). Since these are `devDependencies` with caret ranges, aligning to the highest version is safe.

### L-12: Deduplicate test library declarations

**Current state:**
| Package | `@testing-library/dom` | `@testing-library/jest-dom` | `@testing-library/react` |
|---------|----------------------|---------------------------|------------------------|
| Root | `^10.4.1` | `^6.9.1` | `^16.3.2` |
| `packages/ui` | `^10.4.0` | `^6.9.1` | `^16.2.0` |

Version drift between root and `packages/ui`.

**Target:** Remove test library declarations from `packages/ui/package.json` (they're already hoisted from root). Verify tests still pass after removal.

**Dependency:** Do L-11 (TypeScript alignment) first to minimize package.json churn.

### L-14: test:unit script consistency

**Current state:**
- Root `"test"` runs `turbo test` (cached, parallelized)
- Root `"test:unit"` runs `vitest run` directly (bypasses Turbo)

**Target:** Change root `"test:unit"` to `turbo test` or remove it if redundant with `"test"`. If there's a reason for the direct vitest invocation (e.g., running from a specific package), document it.

### L-15: Expand clean:cache

**Current state:** `"clean:cache"` only clears `apps/web/node_modules/.vite`.

**Target:** Expand to also clear `.tsbuildinfo` files and Turbo cache:

```json
"clean:cache": "rm -rf apps/web/node_modules/.vite .turbo apps/*/.turbo packages/*/.turbo **/*.tsbuildinfo"
```

### N-1: Fix lint warnings in OrgSwitcher.test.tsx

**Current state:** 8 `noNonNullAssertion` Biome warnings at lines 126, 145, 165, 180, 222, 248, 273, 296. All are non-null assertions (`!`) on DOM query results.

**Target:** Replace `!` assertions with proper null checks or use `@testing-library` queries that throw on missing elements (e.g., `getByText` already throws, so `closest('button')!` can be replaced with a helper or explicit assertion).

### N-2: Demo pages use hardcoded colors and raw HTML elements

**Current state:** Demo pages (`store.tsx`, `tanstack-query.tsx`, `start.server-funcs.tsx`, etc.) use raw `&lt;button>`, `&lt;input>` with hardcoded Tailwind classes instead of `@repo/ui` components and design tokens.

**Target:** Replace raw HTML elements with `@repo/ui` components (`Button`, `Input`, `Card`, etc.) and swap hardcoded color classes for design tokens. Keep changes minimal — this is demo code, not production.

## Constraints

- No architectural changes — all items are isolated fixes
- Must not break existing tests or CI
- L-11 must be completed before L-12 (same files, version alignment reduces conflicts)
- All other items are independent and can be parallelized

## Non-goals

- **Rate limiting** — Covered by issue #53
- **Critical/High/Medium audit findings** — Covered by issues #89, #92, and others
- **Full demo page rewrite** — N-2 only swaps elements for `@repo/ui` components; no new functionality or redesign
- **Nitro migration** — L-4 only tracks the release status; if no stable version exists, no migration is needed

## Technical Decisions

| Decision | Rationale |
|----------|-----------|
| Env var substitution with defaults in docker-compose | Keeps local dev zero-config while allowing override in CI/prod |
| Remove test libs from `packages/ui` instead of root | Root hoisting is the intended pattern per monorepo setup |
| Expand `clean:cache` to include `.tsbuildinfo` and `.turbo` | These are the most common stale cache sources causing build issues |
| Use `@testing-library` throwing queries instead of `!` | Follows Biome lint rules and gives better error messages on test failures |

## Success Criteria

- [ ] L-1: `docker-compose.yml` uses `${VAR:-default}` syntax for all credentials
- [ ] L-4: Nitro version is either upgraded to stable or documented as intentionally alpha
- [ ] L-6: Both `specs/index.mdx` and `analyses/index.mdx` list all existing documents
- [ ] L-8: `docs/hooks.mdx` includes a Lefthook section covering all 3 hook stages
- [ ] L-10: `docs/guides/troubleshooting.mdx` exists with 6+ common issues
- [ ] L-11: All `package.json` files use the same TypeScript version range
- [ ] L-12: `@testing-library/*` only declared in root `package.json`
- [ ] L-14: `test:unit` script uses Turbo or is documented/removed
- [ ] L-15: `clean:cache` clears `.tsbuildinfo` and `.turbo` in addition to Vite cache
- [ ] N-1: Zero Biome `noNonNullAssertion` warnings in `OrgSwitcher.test.tsx`
- [ ] N-2: Demo pages use `@repo/ui` components instead of raw HTML elements
- [ ] All existing tests pass
- [ ] CI pipeline passes (lint, typecheck, test)

## Open Questions

- **L-4:** Is nitro v3 stable released yet? Needs a version check at implementation time.
- **L-14:** Is there a use case for running vitest directly (e.g., watch mode in a single package) that justifies keeping `test:unit`?
