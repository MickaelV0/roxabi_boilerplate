---
title: "Issue #10: Git Hooks Analysis"
description: Technical analysis for Roxabi Boilerplate infrastructure
---


## Executive Summary

Git hooks are essential for enforcing code quality gates before code reaches CI/CD. For a Bun/TurboRepo monorepo with Biome, **Lefthook** emerges as the recommended tool due to its runtime-agnostic nature (Go binary), native parallel execution, and excellent monorepo support. The recommended strategy is a **hybrid approach**: fast pre-commit hooks for formatting/linting staged files, and pre-push hooks for comprehensive validation (typecheck + tests).

## State of the Art (2025-2026)

### Current Best Practices

1. **Layered Quality Gates**: Pre-commit for fast checks (< 1s), pre-push for comprehensive validation, CI/CD as the ultimate enforcement
2. **Runtime-Agnostic Tools**: Preference shifting from JavaScript-based tools (Husky) to Go/Rust-based tools (Lefthook) for performance and cross-platform consistency
3. **Incremental Checks**: Only check changed/staged files locally, full validation in CI
4. **Monorepo-Aware Filtering**: Use TurboRepo's `--affected` flag to run only relevant package checks
5. **Parallel Execution**: Run independent checks concurrently to minimize wait time

### Key Trends

- **Biome adoption**: Fast all-in-one linter/formatter replacing ESLint + Prettier
- **Pre-push over pre-commit for tests**: Tests in pre-commit frustrate developers; pre-push is the sweet spot
- **Bypass tolerance**: Local hooks are convenience, CI is enforcement. Developers can `--no-verify` when needed
- **Staged file focus**: lint-staged pattern dominates for pre-commit, ensuring only changed files are checked

## Three Options

### Option A: Husky + lint-staged (Fastest to Implement)

**Description**: The classic JavaScript ecosystem approach. Husky manages hooks via `.husky/` directory with shell scripts, lint-staged handles staged file filtering.

**Setup**:
```bash
bun add -D husky lint-staged
bunx husky init
```

**Configuration** (`.husky/pre-commit`):
```bash
bunx lint-staged
```

**Configuration** (`package.json`):
```json
{
  "lint-staged": {
    "*.{js,ts,jsx,tsx,json}": [
      "biome check --write --no-errors-on-unmatched --files-ignore-unknown=true"
    ]
  }
}
```

**Pre-push** (`.husky/pre-push`):
```bash
bun run typecheck
bun run test
```

**Pros**:
- Most documented, largest community
- Familiar to JavaScript developers
- Easy to find examples and troubleshooting
- Good integration with npm ecosystem

**Cons**:
- Sequential hook execution (slower)
- Relies on shell scripts which can be brittle
- Node.js/Bun PATH issues with version managers
- No built-in parallel execution
- More configuration files to maintain

**Complexity**: 2/5

---

### Option B: Lefthook with Full TurboRepo Integration (Best Quality)

**Description**: Lefthook (Go binary) provides maximum performance with parallel execution, combined with TurboRepo's `--affected` flag for intelligent package filtering.

**Setup**:
```bash
bun add -D lefthook
bunx lefthook install
```

**Configuration** (`lefthook.yml`):
```yaml
pre-commit:
  parallel: true
  commands:
    biome-check:
      glob: "*.{js,ts,jsx,tsx,json,jsonc}"
      run: bunx biome check --write --no-errors-on-unmatched --files-ignore-unknown=true {staged_files}
      stage_fixed: true

pre-push:
  parallel: true
  commands:
    lint:
      run: bun run lint
    typecheck:
      run: bunx turbo typecheck --affected
    test:
      run: bunx turbo test --affected
```

**Advanced Monorepo Configuration** (`lefthook.yml`):
```yaml
pre-commit:
  parallel: true
  commands:
    web-lint:
      root: "apps/web/"
      glob: "*.{ts,tsx}"
      run: bunx biome check --write {staged_files}
      stage_fixed: true
    api-lint:
      root: "apps/api/"
      glob: "*.ts"
      run: bunx biome check --write {staged_files}
      stage_fixed: true

pre-push:
  parallel: true
  commands:
    typecheck-affected:
      run: bunx turbo typecheck --affected
    test-affected:
      run: bunx turbo test --affected
    lint-full:
      run: bun run lint
```

**Pros**:
- Native parallel execution (significantly faster)
- Go binary = runtime agnostic (no Bun/Node PATH issues)
- Built-in staged file handling (`{staged_files}`)
- `stage_fixed: true` auto-stages formatted files
- YAML config is cleaner than shell scripts
- Excellent monorepo support with `root` option
- TurboRepo `--affected` reduces unnecessary work
- Cross-platform consistency

**Cons**:
- Slightly steeper learning curve
- Smaller community than Husky
- Known issue: Turborepo can crash with Lefthook in some configurations (see [GitHub Issue #8349](https://github.com/vercel/turborepo/issues/8349))
- YAML anchors for DRY config can be complex

**Complexity**: 4/5

---

### Option C: Lefthook Simplified (Recommended Balance)

**Description**: Lefthook with a pragmatic configuration - parallel execution and staged file handling without complex TurboRepo `--affected` filtering for local hooks.

**Setup**:
```bash
bun add -D lefthook
bunx lefthook install
```

**Configuration** (`lefthook.yml`):
```yaml
# Simple, fast, effective
pre-commit:
  parallel: true
  commands:
    biome:
      glob: "*.{js,ts,jsx,tsx,json,jsonc,css,md}"
      run: bunx biome check --write --no-errors-on-unmatched --files-ignore-unknown=true {staged_files}
      stage_fixed: true

pre-push:
  parallel: true
  commands:
    typecheck:
      run: bun run typecheck
    test:
      run: bun run test
    lint:
      run: bun run lint
```

**With Optional Skip for Long Tests** (`lefthook.yml`):
```yaml
pre-push:
  parallel: true
  commands:
    typecheck:
      run: bun run typecheck
    test:
      run: bun run test
      skip:
        - merge
        - rebase
    lint:
      run: bun run lint
```

**Pros**:
- Best performance with parallel execution
- Simple YAML configuration
- No complex TurboRepo integration (avoids known bugs)
- TurboRepo caching still works (via `turbo.json` tasks)
- Runtime agnostic = consistent across environments
- Auto-stage fixed files
- Easy to understand and maintain
- Skip conditions for specific scenarios

**Cons**:
- Pre-push runs all packages (not just affected)
- Less sophisticated than Option B
- Smaller community than Husky (but growing)

**Complexity**: 2/5

---

## Comparison Table

| Criteria | Option A (Husky) | Option B (Lefthook Full) | Option C (Lefthook Simple) |
|----------|------------------|--------------------------|---------------------------|
| **Speed** | Slow (sequential) | Fastest (parallel + affected) | Fast (parallel) |
| **Quality** | Good | Excellent | Very Good |
| **Complexity** | 2/5 | 4/5 | 2/5 |
| **Maintenance** | Medium | High | Low |
| **Monorepo Support** | Basic | Excellent | Good |
| **Bun Compatibility** | PATH issues possible | Native (Go binary) | Native (Go binary) |
| **Community** | Large | Growing | Growing |
| **Documentation** | Excellent | Good | Good |
| **TurboRepo Integration** | Manual | Full (`--affected`) | Via caching only |
| **Staged File Handling** | Via lint-staged | Built-in | Built-in |
| **Auto-stage Fixed** | Via lint-staged | Native | Native |

## Recommendation

**Recommended: Option C (Lefthook Simplified)**

### Justification

1. **Runtime Agnostic**: Lefthook's Go binary eliminates Bun/Node PATH issues that plague Husky with version managers
2. **Parallel Execution**: Built-in parallel execution makes pre-push hooks (typecheck + test + lint) significantly faster
3. **Simplicity**: Clean YAML configuration without shell script complexity
4. **Maintainability**: Single config file vs. multiple `.husky/` scripts + lint-staged config
5. **Future-Proof**: Can upgrade to Option B's full TurboRepo integration later when `--affected` issues are resolved
6. **TurboRepo Caching**: Even without `--affected`, TurboRepo's caching means repeated runs are fast
7. **Biome Integration**: Native staged file support works perfectly with Biome's `--write` flag

### Migration Path

Start with Option C. Once the team is comfortable and if pre-push times become problematic:
1. Add TurboRepo `--affected` flag incrementally
2. Consider package-specific `root` configurations
3. Upgrade to Option B when Turborepo/Lefthook compatibility improves

### Implementation Checklist

```bash
# 1. Install Lefthook
bun add -D lefthook

# 2. Create lefthook.yml (see Option C config above)

# 3. Install hooks
bunx lefthook install

# 4. Add to package.json scripts (optional)
# "prepare": "lefthook install"

# 5. Test hooks
git add .
git commit -m "test: verify pre-commit hook"
git push origin feature-branch  # Verify pre-push hook
```

## Key Resources

### Official Documentation
- [Lefthook GitHub](https://github.com/evilmartians/lefthook) - Main repository with documentation
- [Husky Documentation](https://typicode.github.io/husky/) - Official Husky docs
- [Biome Git Hooks Guide](https://biomejs.dev/recipes/git-hooks/) - Official Biome integration guide
- [TurboRepo Run Reference](https://turborepo.dev/docs/reference/run) - `--affected` and `--filter` documentation

### Comparison Articles
- [Lefthook vs Husky 2026](https://www.edopedia.com/blog/lefthook-vs-husky/) - Detailed comparison
- [Git Hooks Guide 2025](https://dev.to/arasosman/git-hooks-for-automated-code-quality-checks-guide-2025-372f) - Best practices overview
- [5 Ways to Configure Lefthook](https://evilmartians.com/chronicles/5-cool-and-surprising-ways-to-configure-lefthook-for-automation-joy) - Advanced patterns

### Pre-commit vs Pre-push Strategy
- [Pre-commit Hooks Guide 2025](https://gatlenculp.medium.com/effortless-code-quality-the-ultimate-pre-commit-hooks-guide-for-2025-57ca501d9835) - Comprehensive strategy guide
- [Pre-push Hooks](https://dev.to/jameson/pre-push-hooks-42g5) - Pre-push specific patterns
- [Pre-commit or CI/CD](https://motlin.medium.com/pre-commit-or-ci-cd-5779d3a0e566) - Tradeoff analysis

### Known Issues
- [Turborepo + Lefthook Crash Issue #8349](https://github.com/vercel/turborepo/issues/8349) - Known compatibility issue
- [TurboRepo --affected Issues](https://github.com/vercel/turborepo/issues/10688) - Tasks unrelated to changes executing

### Alternative Tools
- [simple-git-hooks](https://github.com/toplenboren/simple-git-hooks) - Minimal alternative for very simple needs
- [Biome pre-commit hooks](https://github.com/biomejs/pre-commit) - Official Biome pre-commit framework integration

---

*Analysis prepared for Issue #10: Setup: Git hooks (pre-push, quality gates)*
*Last updated: 2026-02-02*
