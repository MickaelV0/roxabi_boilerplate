---
title: "Project Audit — Full Health Check"
description: "Comprehensive audit covering architecture, security, code quality, testing, infrastructure/DX, and documentation."
---

**Date:** 2026-02-09
**Branch:** main (commit 2f1924b)
**Auditors:** architect, security-auditor, reviewer (now fixer), tester, devops, doc-writer (parallel agents)

---

## Executive Summary

The Roxabi Boilerplate is a **well-architected project** with strong foundations: strict TypeScript, deny-by-default auth, excellent test patterns, shared Vitest presets, comprehensive dev-process documentation, and a mature CI pipeline. However, the audit surfaced **62 unique findings** across 6 domains that need attention before production readiness.

| Severity | Count | Examples |
|----------|-------|---------|
| **Critical / High** | 8 | Default auth secret, no rate limiting, no security headers, version mismatches |
| **Medium** | 19 | CORS config, missing tests, stale docs, devtools in prod |
| **Low / Info** | 16 | Docker hardcoded creds, hardening opportunities |
| **Good Practices** | 19 | Noted for replication and documentation |

**Top 3 cross-cutting themes:**
1. **Port / env var confusion** — flagged by 4 of 6 agents independently
2. **Auth hardening gaps** — default secret, no rate limiting, no security headers
3. **Missing tests for critical auth paths** — AuthService, ZodValidationPipe, auth E2E

---

## Critical / High Priority

These must be addressed before any production deployment.

### C-1: Default `BETTER_AUTH_SECRET` allows session forgery
**Agents:** Security, Reviewer | **Category:** Security

`apps/api/src/config/env.validation.ts:32` — hardcoded default `'dev-secret-do-not-use-in-production'`. App starts without env var set. If deployed as-is, all sessions can be forged.

**Fix:** Remove default value entirely. Add runtime guard: if `NODE_ENV === 'production'` and value matches known defaults, throw on startup.

---

### C-2: No rate limiting on any API endpoint
**Agent:** Security | **Category:** Security

Zero rate limiting anywhere. Auth endpoints (`/api/auth/*`), magic link, password reset — all wide open to brute-force, credential stuffing, and email flooding.

**Fix:** Install `@nestjs/throttler`. Apply strict limits on auth endpoints (10 req/60s), moderate globally (100 req/60s).

---

### C-3: No security headers (Helmet, CSP, HSTS)
**Agent:** Security | **Category:** Security

`apps/api/src/main.ts` — No `@fastify/helmet`, no CSP, no HSTS, no X-Frame-Options. Susceptible to clickjacking, MIME sniffing, no XSS mitigation layer.

**Fix:** Install `@fastify/helmet` and configure in `main.ts` before routes.

---

### C-4: User profile endpoint returns all DB columns
**Agents:** Security, Reviewer | **Category:** Security / Correctness

`apps/api/src/user/user.service.ts:10-12` — `.select()` without column list returns everything including `banReason`, `banned`, `banExpires`. Will get worse as schema grows.

**Fix:** Explicit column selection + response DTO.

---

### C-5: Port / env var mismatch (3-way inconsistency)
**Agents:** Reviewer, Infra, Docs | **Category:** Correctness / DX

| Source | Value |
|--------|-------|
| Root `.env.example` | `API_PORT=4000` |
| API `env.validation.ts` | `PORT=3001` (default) |
| API `main.ts` | reads `PORT`, defaults `3001` |
| Vite proxy | hardcoded `localhost:3001` |
| Docs `getting-started.mdx` | says port `4000` |

The API reads `PORT` (not `API_PORT`), so root `.env.example` `API_PORT=4000` is **ignored entirely**. A fresh clone breaks immediately.

**Fix:** Align everything to `PORT=3001` or make the API read `API_PORT`. Update all docs and `.env.example` files.

---

### C-6: Bun/Node version mismatches across project
**Agent:** Infra | **Category:** DX / CI

| Source | Bun | Node |
|--------|-----|------|
| `package.json` packageManager | `1.1.0` | `>=24` |
| Local machine | `1.3.9` | — |
| CI workflow | `1.3.6` | `24` |
| CD workflow | — | `20` |
| Docs `configuration.mdx` | `>= 1.1.0` | `>= 20` |
| Docs `getting-started.mdx` | `>= 1.0` | — |

**Fix:** Align `packageManager` to `bun@1.3.6`, CD Node to `24`, all docs to match.

---

### C-7: `ResendEmailProvider.send()` swallows errors silently
**Agent:** Reviewer | **Category:** Reliability

`apps/api/src/auth/email/resend.provider.ts:34-40` — No try/catch around Resend SDK call. If it throws (network error, invalid API key, rate limit), the exception propagates into Better Auth internals, potentially crashing email verification, password reset, and magic link flows.

**Fix:** Wrap in try/catch, log with correlation ID, throw domain exception.

---

### C-8: Correlation ID interceptor runs too late in NestJS lifecycle
**Agents:** Reviewer, Architect | **Category:** Observability

Documented standard violation (`backend-patterns.mdx` Section 1.5). As an interceptor, the correlation ID isn't available during guard execution. Auth failures log `'unknown'` instead of a correlation ID.

**Fix:** Migrate from interceptor to middleware (tracked tech debt).

---

## Medium Priority

Address in the next sprint cycle.

### Security

| # | Finding | File | Agent |
|---|---------|------|-------|
| M-1 | CORS accepts single string, no wildcard validation in prod | `main.ts:33-35` | Security |
| M-2 | Demo server functions have no auth or input validation | `start.server-funcs.tsx`, `api.tq-todos.ts` | Security |
| M-3 | No explicit Fastify body size limit | `main.ts:9-15` | Security |
| M-4 | Devtools unconditionally bundled in production | `__root.tsx:1,9,100-112` | Security |
| M-5 | `@faker-js/faker` in production dependencies (6MB) | `apps/web/package.json:17` | Security, Infra |
| M-6 | `marked` in deps without DOMPurify | `apps/web/package.json:53` | Security |
| M-7 | Email templates use string interpolation for HTML | `auth.instance.ts:55-60` | Security |

### Code Quality

| # | Finding | File | Agent |
|---|---------|------|-------|
| M-8 | `DocsErrorBoundary` uses class component (standard violation) | `docs-error-boundary.tsx:15` | Reviewer |
| M-9 | `ApiResponse&lt;T>` is not a discriminated union (standard violation) | `packages/types/src/index.ts:14-22` | Reviewer |
| M-10 | `as` type casts in production code instead of type guards | `auth.guard.ts:37`, `correlation-id.interceptor.ts:19` | Reviewer |
| M-11 | `Roles` decorator uses `string[]` instead of typed union | `roles.decorator.ts:3` | Reviewer |
| M-12 | Auth form pages missing error handling for `handleOAuth` | `login.tsx:61-63`, `register.tsx` | Reviewer |
| M-13 | `UserService.getProfile` returns null → controller sends 200 OK with null body | `user.service.ts:11-12` | Reviewer |

### Testing Gaps

| # | Finding | File | Agent |
|---|---------|------|-------|
| M-14 | No `AuthService` tests (core auth, 0% coverage) | `auth.service.ts` | Tester |
| M-15 | No `ZodValidationPipe` tests (input validation, 20% coverage) | `zod-validation.pipe.ts` | Tester |
| M-16 | No `fastify-headers.ts` tests (pure utility, 0% coverage) | `fastify-headers.ts` | Tester |
| M-17 | No auth E2E tests (signup, login, logout, protected routes) | Missing | Tester |
| M-18 | No NestJS integration tests (`Test.createTestingModule`) | Missing | Tester |
| M-19 | Auth form pages (login, register, reset-password) have no tests | `login.tsx`, `register.tsx`, `reset-password.tsx` | Reviewer, Tester |

### Documentation

| # | Finding | File | Agent |
|---|---------|------|-------|
| M-20 | `JWT_SECRET` in docs, `BETTER_AUTH_SECRET` in code | `configuration.mdx` | Docs |
| M-21 | Swagger URL wrong in getting-started (`/docs` vs `/api/docs`) | `getting-started.mdx` | Docs |
| M-22 | No database architecture documentation | Missing | Docs |
| M-23 | No authentication guide | Missing | Docs |
| M-24 | Branch naming conflict (`feature/` vs `feat/`) across docs | `contributing.mdx` vs `dev-process.mdx` | Docs |
| M-25 | Priority label conflict (P0-P3 vs P1-P3) across docs | `contributing.mdx` vs `issue-management.mdx` | Docs |

### Infrastructure

| # | Finding | File | Agent |
|---|---------|------|-------|
| M-26 | Missing `inputs` on `build`/`typecheck` Turbo tasks (cache efficiency) | `turbo.json` | Infra |
| M-27 | Biome version conflict (root `^2.3.14` vs web `2.2.4`) | `package.json` files | Infra |

---

## Low Priority / Hardening

| # | Finding | Category | Agent |
|---|---------|----------|-------|
| L-1 | Docker Compose hardcoded DB password (`roxabi`) | Security | Security |
| L-2 | Server binds `0.0.0.0` by default (not configurable) | Security | Security |
| L-3 | Correlation ID accepted without format validation | Security | Security |
| L-4 | `nitro` alpha dependency in production | Supply Chain | Security |
| L-5 | No README.md at project root | Docs | Docs |
| L-6 | Specs/analyses index pages stale (only list first entries) | Docs | Docs |
| L-7 | "REST + optional GraphQL" in architecture docs (no GraphQL exists) | Docs | Docs |
| L-8 | Lefthook git hooks not documented | Docs | Docs |
| L-9 | Getting-started ordering: GitHub config before local setup | DX | Docs |
| L-10 | No troubleshooting guide | Docs | Docs |
| L-11 | TypeScript version range divergence across 6 packages | Maintenance | Infra |
| L-12 | Duplicate test library declarations in root + packages | Maintenance | Infra |
| L-13 | `vitest` not in `apps/api` devDependencies (relies on hoisting) | Maintenance | Infra |
| L-14 | `test:unit` script bypasses Turbo caching | Maintenance | Infra |
| L-15 | `clean:cache` only clears Vite cache | Maintenance | Infra |
| L-16 | Auth page strings not internationalized | i18n | Reviewer |

---

## Tech Debt Tracker

| Item | Current State | Target State | Source |
|------|---------------|--------------|--------|
| Correlation ID | Interceptor | Middleware | `backend-patterns.mdx` |
| Env validation | `class-validator` | Zod (already have `ZodValidationPipe`) | `backend-patterns.mdx` |
| Auth schema timestamps | Inline (no timezone, no `$onUpdateFn`) | Use shared `timestamps` from `base.ts` | Reviewer |
| `globals: true` in vitest config | Enabled | Disabled (per testing standards) | Tester |
| Missing `cleanup()` in test setups | Not called | `afterEach(() => cleanup())` | Tester |
| Shared mock factories | Duplicated per test file | Centralized in `test/__mocks__/` | Tester |
| Demo table page | Hardcoded Tailwind classes | Use design system tokens + `@repo/ui` components | Reviewer |
| `.dockerignore` | Excludes all app code (docs-only) + typo `apps/packages` | Restructured for app Docker builds | Infra |
| No Dockerfiles | Placeholder CD steps | Production Dockerfiles for web + API | Infra |

---

## Good Practices Worth Documenting

These are strengths identified across the audit — worth preserving and replicating.

| Practice | Where | Agent |
|----------|-------|-------|
| Global auth guard with deny-by-default | `auth.module.ts` | Security |
| Swagger disabled in production | `main.ts` | Security |
| Security check hook on file writes | `.claude/hooks/security-check.js` | Security |
| Strict TypeScript (`strict`, `noUncheckedIndexedAccess`) | `tsconfig.base.json` | Infra |
| Lefthook pre-commit with `stage_fixed: true` | `lefthook.yml` | Infra |
| Commitlint enforcement via commit-msg hook | `lefthook.yml` | Infra |
| Smart E2E path filtering + Playwright caching in CI | `ci.yml` | Infra |
| Coverage ratcheting with `thresholds.autoUpdate` | `vitest.config.ts` | Tester |
| Auth guard tests as gold standard (10 tests, factory pattern) | `auth.guard.test.ts` | Tester |
| Theme engine tests with mathematical invariants | `theme.test.ts` | Tester |
| Parametric preset testing (auto-covers new presets) | `presets.test.ts` | Tester |
| License checker with policy-driven compliance | `tools/license-checker.ts` | Infra |
| Symbol injection tokens for DI (no string tokens) | `drizzle.provider.ts`, `email.provider.ts` | Reviewer |
| Graceful DB degradation (nullable in dev, throw in prod) | `drizzle.provider.ts` | Reviewer |
| Clean auth instance / auth service separation | `auth.instance.ts` / `auth.service.ts` | Reviewer |
| CVA + data-slot pattern consistently across all UI components | `packages/ui/src/components/` | Reviewer |
| `AnimatedSection` respects `prefers-reduced-motion` | `AnimatedSection.tsx` | Reviewer |
| Shared vitest presets via `@repo/config` | `packages/config/src/vitest.ts` | Tester |
| Comprehensive dev-process with tier system | `docs/processes/dev-process.mdx` | Docs |

---

## Recommended Action Plan

### Phase 1 — Security Hardening (before any deployment)
1. [C-1] Production guard for auth secret
2. [C-2] Install `@nestjs/throttler` with rate limiting
3. [C-3] Install `@fastify/helmet` with security headers
4. [C-4] Explicit column selection in user queries + DTO

### Phase 2 — Correctness &amp; DX (next sprint)
5. [C-5] Fix port/env var mismatch across project
6. [C-6] Align Bun/Node versions everywhere
7. [C-7] Add error handling to Resend email provider
8. [C-8] Migrate correlation ID to middleware
9. [M-20-25] Fix all stale documentation

### Phase 3 — Test Coverage (following sprint)
10. [M-14] Add `AuthService` tests
11. [M-15] Add `ZodValidationPipe` tests
12. [M-16] Add `fastify-headers.ts` tests
13. [M-17] Add auth E2E tests
14. [M-19] Add auth form page tests

### Phase 4 — Cleanup &amp; Hardening (ongoing)
15. [M-4-7] Move faker to devDeps, remove marked, conditional devtools
16. [M-8-13] Code quality fixes (class component, discriminated union, type casts)
17. [L-*] Low priority items and tech debt from tracker

---

*Generated by parallel agent audit. Each finding includes the originating agent for traceability.*
