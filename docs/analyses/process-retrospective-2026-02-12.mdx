---
title: "Process Retrospective — Team Debate"
description: "Multi-agent debate on development process improvements across workflow, quality, security, testing, and documentation."
---

**Date:** 2026-02-12
**Branch:** staging (commit cf98e89)
**Facilitator:** product-lead
**Participants:** architect, reviewer (now fixer), security-auditor, tester, doc-writer

---

## Executive Summary

Five specialized agents debated 25 process topics across 5 domains. The debate surfaced strong consensus on 6 actions and productive disagreement on 6 others. The overarching finding: **our process documentation is excellent but our execution has gaps** — particularly in testing, security gates, and process weight management.

### Key Numbers

| Metric | Value |
|--------|-------|
| Topics debated | 25 (5 per agent) |
| Consensus items | 6 (act immediately) |
| Disagreement items | 6 (need lead decision) |
| Proposed action items | 12 |

---

## Agent Briefs

### 1. Architect — System Design &amp; Complexity Perspective

#### 1.1 Tier System: F-lite / F-full instead of adding Tier M

**Position: Don't add a third tier letter. Formalize two tracks within Tier F.**

The binary S/F system already has a de facto middle ground. The tech debt analysis (`95-tech-debt-audit-remediation.mdx`) literally wrote "Tier: M (Medium)" in its conclusions. The F.1 table already has "Local scope, 3-10 files, clear requirements — Bootstrap Optional" but it's buried in a table cell.

**Recommendation:**

| Track | Criteria | Process |
|-------|----------|---------|
| **F-lite** | 4-10 files, requirements documented, no arch risk | Worktree + subagents + /review (skip bootstrap) |
| **F-full** | >10 files, OR new system/arch, OR unclear requirements | Bootstrap + worktree + agents + /review |

#### 1.2 Bootstrap: Judgment-based, not file-count

**Position: Replace file count trigger with a decision tree.**

Counter-examples prove the file-count rule is broken:
- **High count, zero ambiguity:** `globals: true` removal touches 50+ files but is mechanical
- **Low count, high ambiguity:** Rate limiting (C-2) is 3-4 files but has significant design decisions

**Proposed decision tree:**
```
New architectural concepts or patterns?              -> Bootstrap
Unclear or competing requirements?                   -> Bootstrap
Affects >2 domain boundaries?                        -> Bootstrap
Mechanical/repetitive regardless of file count?      -> Skip bootstrap
Requirements fully documented (analysis/audit)?      -> Skip bootstrap
```

#### 1.3 Agent Teams: Subagents should be the default

**Position: For this codebase size, subagents (Task tool) should be default. Reserve full teams for genuine multi-domain concurrency.**

The overhead of Agent Teams (separate context windows, coordination, context duplication) is high. The project audit used 6 agents to find 62 findings — impressive — but the findings were consolidated by a single agent and implemented in 2 PRs.

**Proposed routing update:**
```
Tier S                              -> Single session (no agents)
Tier F, single domain               -> 1 domain subagent + 1 tester (Task tool)
Tier F, 2+ domains parallelizable   -> Agent Teams (minimal: 2 domain + 1 tester)
Tier F, >10 files with bootstrap    -> Full team only if 3+ domains
```

#### 1.4 Pre-PR Self-Review: Strongly yes

**Position: Bake self-review into agent `.md` files as mandatory behavior.**

The audit findings (M-8, M-9, M-10, M-4) are pattern violations that a 30-second diff review would have caught. Costs ~1 extra turn per agent, saves 2-3 turns of reviewer back-and-forth.

#### 1.5 Tech Debt: "The process is eating itself"

**Position: We've spent more commits on meta-code (agent definitions, skills, process docs) than on product features.**

**Three structural changes proposed:**
1. **Debt ratio:** For every 2 feature PRs, 1 debt-paydown PR must merge
2. **Freeze process docs** for 4 weeks and see if anything breaks
3. **Prioritize by blast radius:** Nothing ships until C-1 through C-4 are closed

---

### 2. Reviewer — Code Quality &amp; Review Perspective

#### 2.1 Review Timing: Enforce existing F.6, don't add a gate

**Position: The self-review step already exists at F.6. The problem is enforcement, not a missing step.**

Adding another gate slows Tier F by a full agent round-trip. The fix is **accountability**: require a checklist comment on the PR body and escalate skipped self-reviews as process failures.

#### 2.2 AI Review as Required Approval: Yes, with caveats

**Position: AI reviewer counts as the required "1 approval" for Tier S and non-user-facing Tier F.**

The AI reviewer is more thorough and consistent than human reviewers on this codebase. Blind spot: **product intent** — AI can verify correctness but not that the feature matches what users wanted.

**Recommendation:**
- AI approval sufficient for Tier S and backend-only/refactor Tier F
- Product-lead merge approval (F.8) serves as implicit product review for user-facing features
- Document this explicitly

#### 2.3 TDD Enforcement: CI ratchet, no standard change

**Position: The standard is right. Execution failed. Enforce with CI.**

The entire authentication flow has **zero tests** at every layer. The audit put test coverage in "Phase 3" — the reviewer argues M-14 (AuthService) and M-17 (auth E2E) belong in **Phase 1** because untested auth code is a security risk.

**Three-phase ratchet:**
1. **Immediately:** CI check — new `.ts`/`.tsx` files must have corresponding test files
2. **Next sprint:** 70% coverage threshold as hard CI fail
3. **Ongoing:** Dedicated P1 issues for M-14 through M-19

> "What I will NOT accept: 'Adjust the standard to match reality.' The standard is correct."

#### 2.4 Conventional Comments: Keep everywhere, add mandatory praise

**Position: Keep for all tiers. No simplification.**

The `(blocking)` / `(non-blocking)` decorator system eliminates "is the reviewer nitpicking or demanding a change?" ambiguity. **Add one rule:** every review must include at least one `praise:` comment.

#### 2.5 Auto-Fix Scope: Auto-fix deterministic issues, flag design decisions

**Position: The current auto-fix model is correct but needs boundaries.**

| Category | Auto-fix? |
|----------|-----------|
| `todo:` items (missing imports, correlation IDs) | **Yes** |
| `issue(blocking):` type safety (`as` -> type guard) | **Yes** |
| `suggestion(blocking):` architecture changes | **Flag only** |
| Anything changing public API contracts | **Flag only + create task** |

---

### 3. Security Auditor — Security Perspective

#### 3.1 Security Hook: Promote XSS to blocking, add patterns

**Position: Blocking rules must exit code 2. Non-negotiable.**

Current hook catches `eval()` / `innerHTML` as warn-only. These are XSS vectors, not "maybes."

**Missing patterns to add:**
- `sql.raw()` with user input
- Default auth secrets in Zod `.default()` syntax
- `localStorage.setItem('token',...)` patterns
- Missing `@UseGuards()` on new controllers

#### 3.2 Security-Auditor Invocation: Mandatory on auth/API/user data

**Position: The "security-sensitive" trigger is a subjective judgment call that demonstrably failed.**

The entire auth system (30+ files) shipped without a single security-auditor invocation. **All 4 critical findings (C-1 through C-4) were in auth code** and would have been caught by the OWASP checklist.

**Mandatory path triggers:**
1. `apps/api/src/auth/**`
2. `apps/api/src/**/**.guard.ts`
3. `apps/api/src/**/**.controller.ts`
4. `apps/api/src/config/env.validation.ts`
5. Any migration file
6. Any `package.json` change

#### 3.3 CI Security Scanning: Add bun audit + semgrep

**Position: We need dependency scanning AND SAST in CI. Today.**

Our CI pipeline has lint, typecheck, test, build — **no security step.** The audit found `nitro` alpha dependency, `@faker-js/faker` in prod deps (6MB), `marked` without DOMPurify. None caught by CI.

**Proposed additions:**
1. `bun audit` — fails on high/critical CVEs
2. `semgrep` with `p/owasp-top-ten` config
3. Extend existing license-checker philosophy to vulnerability scanning

#### 3.4 Default Auth Secret (C-1): Defense in depth

**Position: The vulnerability should have been prevented at spec, caught at review, and blocked at CI. Three layers failed.**

Root cause trace:
1. Spec said "Required" but didn't say "MUST NOT have a default"
2. Implementation added `.default('dev-secret-do-not-use-in-production')`
3. Code review didn't flag Zod `.default()` on a secret
4. Security hook didn't detect the pattern

#### 3.5 Security in Specs: Mandatory section

**Position: Every spec must include a "Security Considerations" section.**

The auth spec (`19-auth-users.mdx`) has zero security section. No threat model, no OWASP mapping, no rate limiting requirements.

**Proposed mandatory template:**
```markdown
## Security Considerations
### Threat Model
- What data does this feature handle? (PII, credentials, tokens)
- What are the attack vectors?
- What trust boundaries does it cross?
### OWASP Checklist
- Injection: How is user input validated?
- Authentication: How are sessions managed?
- Data Exposure: What data is returned? Is it minimized?
- Access Control: Who can access? What roles?
- Security Misconfiguration: Rate limiting? Headers? CORS?
```

---

### 4. Tester — Testing &amp; QA Perspective

#### 4.1 TDD: Enforce, don't redefine

**Position: "The testing story is a lie we're telling ourselves."**

91 component tests for UI elements (Badge, Skeleton, Tooltip) but **zero tests** for AuthService, ZodValidationPipe, auth E2E, auth form pages. The testing effort went to the **periphery** instead of the **core**.

> "Don't redefine TDD down. Acknowledge we haven't been doing it."

#### 4.2 Test Infra Debt: Partially resolved

**Position: Two of three items are already fixed.**

| Item | Status |
|------|--------|
| `globals: true` | **FIXED** |
| Missing `cleanup()` | **FIXED** |
| Shared mock factories | Still open (P1, not P0) |

#### 4.3 Coverage: Necessary but not sufficient

**Position: Keep coverage as a CI gate. Add assertion density as a secondary metric.**

Coverage tells you code was *executed*, not *verified*. Proposed addition: flag test files with suspiciously low assertion-to-test ratios.

**Per-directory targets need to be *configured*, not just documented:**
- 90% for services/domain logic
- 80% for controllers/glue code

#### 4.4 E2E Gap: Don't block MVP, but Sprint 1 post-MVP

**Position: Auth E2E should NOT block MVP but MUST be first post-MVP work.**

5 Playwright tests cover 80% of auth surface:
1. Signup with email/password
2. Login with email/password
3. Access protected route (verify redirect)
4. Logout
5. Magic link flow

Ship within 1 week of MVP.

#### 4.5 Tester Agent Timing: Test-first is the whole point

**Position: The process contradicts itself. Fix it.**

`dev-process.mdx` F.5 says: implement first, then tests (step 4). `testing.mdx` AI-Assisted TDD Workflow says: write tests first. These contradict each other.

**Proposed flip:**
```
1. Tester writes failing tests (RED)
2. Domain agent implements to pass (GREEN)
3. Domain agent refactors (REFACTOR)
4. Tester verifies and adds edge cases
```

---

### 5. Doc-Writer — Documentation &amp; DX Perspective

#### 5.1 Doc Freshness: Lightweight CI lint

**Position: Add a ~50-line CI script for structural validation.**

The audit found onboarding-breaking inconsistencies: wrong env var names, wrong ports, wrong URLs. A new dev following `getting-started.mdx` hits three failures in 30 minutes.

**CI checks:**
1. Env var cross-reference (`.env.example` vs `env.validation.ts` vs docs)
2. URL/port validation (localhost URLs match known configs)
3. Internal link resolution (no dead links)

#### 5.2 Documentation Burden: Keep 5 categories

**Position: Keep all categories but merge `architecture/` into `guides/` (only 2 files, too thin for its own folder).**

The categories serve genuinely different functions. Agents don't browse categories — they follow the CLAUDE.md routing table. The folder structure matters less than the routing table being correct.

#### 5.3 CLAUDE.md: At capacity — move content out

**Position: Cut from 245 to ~120 lines. Replace duplicated sections with one-line pointers.**

Only Critical Rules (~90 lines) must persist every turn. Agent Teams section (50 lines) already exists in `agent-teams.mdx`. Deployment already exists in `deployment.mdx`. Skills table already exists in each SKILL.md.

> "The tipping point is NOW. Any recommendation that says 'add X to CLAUDE.md' should say 'add X to the relevant doc, add a one-line pointer.'"

#### 5.4 Skills vs Passive Docs: Fix reliability, don't convert

**Position: Don't convert skills to passive docs. Fix invocation reliability.**

Skills and docs solve different problems:
- Passive docs = knowledge ("here's what ports to use")
- Skills = workflows ("run these 8 steps with validations")

`/commit` without guardrails = agents forget HEREDOC format and occasionally force-push. The 53% invocation rate is a problem, but missing guardrails is worse.

#### 5.5 Analysis Lifecycle: Status frontmatter + auto-index

**Position: Add `status` field, auto-generate index. Never delete, never expire on timer.**

```yaml
status: active | implemented | superseded | archived
```

Transition rule: when a spec's PR merges, doc-writer marks the analysis as `implemented`. Auto-generated index groups by status — active first, implemented collapsed.

---

## Synthesis — Consensus &amp; Tensions

### Consensus (6 items — act on these)

| # | Decision | Agents Aligned | Action |
|---|----------|---------------|--------|
| 1 | **Auth tests are P0** | Reviewer, Tester, Security | Write AuthService + ZodValidationPipe + auth E2E tests before new features |
| 2 | **Stop-ship on C-1 to C-4** | Architect, Security | Security hardening sprint before production |
| 3 | **Self-review enforcement** | Architect, Reviewer | Bake checklist into agent `.md` files |
| 4 | **CI docs-lint** | Doc-writer, Architect | 50-line script for env vars, ports, links |
| 5 | **Mandatory security in specs** | Security (strongly) | Add "Security Considerations" section to spec template |
| 6 | **CLAUDE.md needs trimming** | Doc-writer | Cut to ~120 lines, replace duplication with pointers |

### Tensions (6 items — need lead decision)

| # | Tension | Side A | Side B |
|---|---------|--------|--------|
| 1 | **New gate vs enforce existing** | Architect: formal self-review gate in agent .md | Reviewer: enforce F.6, no new gate |
| 2 | **Process weight** | Architect: "process eating itself," freeze docs 4 weeks | Security: "friction is a feature" |
| 3 | **Tester ordering** | Tester: flip F.5 to test-first | Current process: test-after |
| 4 | **Skills vs passive docs** | Doc-writer: fix skill reliability | Vercel research: passive docs win |
| 5 | **Agent Teams default** | Architect: subagents default, teams rare | Current: teams for multi-domain |
| 6 | **E2E blocks MVP?** | Tester: no, Sprint 1 post-MVP | Security (implied): pre-deploy |

### Product Lead Recommendations

| # | Tension | My Call | Rationale |
|---|---------|---------|-----------|
| 1 | New gate vs enforce existing | **Go with Architect** — bake into agent .md | Costs 1 turn, saves 3. Cheap insurance. |
| 2 | Process weight | **Split the baby** — freeze process docs, ADD security gates | Both are right in their domains |
| 3 | Tester ordering | **Go with Tester** — flip to test-first | Align process with our own TDD standard |
| 4 | Skills vs passive docs | **Go with Doc-writer** — fix triggers, keep guardrails | Skills provide enforcement passive docs can't |
| 5 | Agent Teams default | **Go with Architect** — subagents default | 2-3 agents max for this codebase size |
| 6 | E2E blocks MVP? | **Go with Tester** — pragmatic, hard deadline post-MVP | Ship fast, verify fast |

---

## Proposed Action Items

| # | Action | Owner | Priority | Size |
|---|--------|-------|----------|------|
| 1 | Security hardening sprint (C-1 to C-4) | backend-dev + security-auditor | **P0** | L |
| 2 | Write AuthService + ZodValidationPipe + fastify-headers tests | tester | **P0** | M |
| 3 | Add "Security Considerations" to spec template | product-lead | **P0** | XS |
| 4 | Add `bun audit` + semgrep to CI | devops | **P1** | S |
| 5 | Trim CLAUDE.md to ~120 lines | doc-writer | **P1** | S |
| 6 | CI docs-lint script (env vars, ports, links) | devops | **P1** | S |
| 7 | Update dev-process: F-lite/F-full tracks, test-first ordering | doc-writer | **P1** | S |
| 8 | Bake self-review checklist into agent .md files | doc-writer | **P1** | S |
| 9 | Add security hook patterns (sql.raw, Zod defaults, XSS to blocking) | devops | **P1** | S |
| 10 | Mandatory security-auditor path filter in CI | devops | **P2** | M |
| 11 | Analysis lifecycle: status frontmatter + auto-index | doc-writer | **P2** | S |
| 12 | Auth E2E tests (5 core flows) | tester | **P1** | M |

---

## Notable Quotes

> "The process is eating itself." — **Architect**, on meta-code vs product feature ratio

> "Friction on security patterns is a feature." — **Security Auditor**, on blocking hooks

> "The testing story is a lie we're telling ourselves." — **Tester**, on TDD mandate vs reality

> "What I will NOT accept: 'Adjust the standard to match reality.' The standard is correct." — **Reviewer**, on TDD enforcement

> "The tipping point is NOW. Any recommendation that says 'add X to CLAUDE.md' should say 'add X to the relevant doc, add a one-line pointer.'" — **Doc-Writer**, on CLAUDE.md bloat

---

*Generated by 5-agent parallel debate. Each position includes the originating agent for traceability.*
