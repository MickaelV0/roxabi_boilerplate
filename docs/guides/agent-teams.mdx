---
title: Agent Teams
description: Getting started with multi-agent coordination using Claude Code Agent Teams
---

# Agent Teams

Run specialized AI agents in parallel to implement features faster. Each agent has a dedicated role, domain, and tool access.

## Prerequisites

- Claude Code CLI installed
- Agent Teams enabled (experimental):

```bash
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
```

Add this to your shell profile (`.bashrc`, `.zshrc`) to persist across sessions.

## How It Works

### Subagents (`.claude/agents/`)

Each `.md` file in `.claude/agents/` defines a **subagent** — a pre-defined role with specific tools, permissions, and domain boundaries. Claude Code auto-discovers these files and makes them available as specialized workers within a single session via the `Task` tool.

Subagents are **stable** and work without any experimental flags.

### Agent Teams (experimental swarm)

Agent Teams go further: multiple independent Claude Code sessions coordinate in parallel via a shared task list and mailbox. Each teammate runs as a separate process with its own context window.

Agent Teams require the experimental flag:

```bash
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
```

### How they connect

The `.md` files in `.claude/agents/` serve **both** purposes:
- **Single session**: The lead uses `Task` tool to delegate work to a subagent by referencing its definition
- **Agent Teams**: Team members reference the same `.md` files as their `agentType`, getting the same role, tools, and permissions

---

## Quick Start

### 1. Determine your tier

Before spawning agents, check the [Development Process](/docs/processes/dev-process) to classify your task:

| Tier | Files | Agent Mode |
|------|-------|------------|
| **S** | 1-3 | Single session + optional tester subagent |
| **F** | >3 | Bootstrap (if needed) → subagents or Agent Teams → /review |

### 2. Pick your agents

Use the routing decision tree:

```
Is this a code change?
├── No (docs only) → doc-writer subagent
└── Yes
    ├── Tier S (≤3 files, no arch risk)
    │   └── Single session + optional tester subagent
    │
    └── Tier F (>3 files, or arch/regression risk)
        ├── Bootstrap (/bootstrap, if needed): product-lead + architect + doc-writer
        ├── Spawn agents:
        │   ├── Single-domain → subagents (Task tool)
        │   └── Multi-domain  → Agent Teams (TeamCreate)
        │   ├── Frontend? → frontend-dev + tester
        │   ├── Backend?  → backend-dev + tester
        │   ├── Full-stack? → frontend-dev + backend-dev + tester
        │   ├── Large scope? → + architect + doc-writer
        │   └── Security-sensitive? → + security-auditor
        └── Then /review after PR (spawns reviewer on the PR)
```

### 3. Start a session

**Single session (subagents via Task tool):**

```bash
# Start Claude Code — subagents are auto-discovered from .claude/agents/
claude

# Ask Claude to delegate to a subagent
> "Use the frontend-dev agent to implement the UserProfile component"
```

Claude uses the `Task` tool internally to spawn the subagent with the role's tools and permissions.

**Run as a specific agent (`--agent`):**

```bash
# Start Claude Code as a pre-defined agent
claude --agent backend-dev
```

The `--agent` flag loads an agent definition from `.claude/agents/<name>.md` (or `~/.claude/agents/`) and applies it to the **main conversation** — not as a subagent. The session uses the agent's system prompt, tools, permissions, and model. Useful for dedicated single-domain work sessions.

**Define ephemeral agents inline (`--agents`):**

```bash
# Pass agent definitions as JSON for a single session (not saved to disk)
claude --agents '{
  "quick-reviewer": {
    "description": "Quick code reviewer",
    "prompt": "You are a senior code reviewer. Focus on correctness and security.",
    "tools": ["Read", "Grep", "Glob"],
    "model": "sonnet"
  }
}'
```

The `--agents` (plural) flag accepts JSON with the same fields as agent `.md` frontmatter: `description`, `prompt`, `tools`, `disallowedTools`, `model`, `permissionMode`, `maxTurns`, `skills`, `hooks`, and `memory`. These agents exist only for the current session.

**Agent Teams (experimental — multiple independent sessions):**

```bash
# Enable agent teams
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1

# Start Claude Code as the lead
claude

# Spawn teammates as independent sessions
/teammates add frontend-dev backend-dev tester
```

### 4. Create tasks and assign

As the lead, you create tasks and set dependencies:

```
Create a task list for implementing the user profile page:
1. "Implement GET /api/users/:id endpoint" → assign to backend-dev
2. "Create UserProfile component" → assign to frontend-dev, blocked by task 1
3. "Write tests for user profile" → assign to tester, blocked by tasks 1 and 2
4. Create PR, then run /review
```

Agents will claim tasks matching their domain and execute within their boundaries.

### 5. Review and merge

Once all tasks are complete, review the deliverables and create the PR.

---

## Available Agents

### Domain Agents (code writers)

| Agent | Color | Domain | Standards |
|-------|-------|--------|-----------|
| **frontend-dev** | cyan | `apps/web/`, `packages/ui/` | [Frontend Patterns](/docs/standards/frontend-patterns) |
| **backend-dev** | green | `apps/api/`, `packages/types/` | [Backend Patterns](/docs/standards/backend-patterns) |
| **infra-ops** | yellow | `packages/config/`, root configs | [Configuration](/docs/configuration) |

### Quality Agents (verification)

| Agent | Color | Role | Standards |
|-------|-------|------|-----------|
| **reviewer** | magenta | Code review, fix, CI verification | [Code Review](/docs/standards/code-review) |
| **tester** | blue | Test generation &amp; validation | [Testing](/docs/standards/testing) |
| **security-auditor** | red | Vulnerability detection | OWASP Top 10 |

### Strategy Agents (planning &amp; alignment)

| Agent | Color | Role | Standards |
|-------|-------|------|-----------|
| **architect** | white | System design, tier classification | [Architecture](/docs/architecture/) |
| **product-lead** | purple | Product ownership, requirements, triage | [Issue Management](/docs/processes/issue-management) |
| **doc-writer** | gray | Documentation maintenance | [Contributing](/docs/contributing) |

---

## Agent Configuration

Each agent's `.md` file contains YAML frontmatter that controls its behavior:

### `permissionMode`

Controls what the agent can do without user approval.

| Mode | Meaning | Used by |
|------|---------|---------|
| `bypassPermissions` | Agent can execute all its tools freely — appropriate for agents that write code or fix issues | frontend-dev, backend-dev, infra-ops, tester, doc-writer, product-lead, architect, reviewer |
| `plan` | Agent can only read and analyze — it proposes changes but cannot execute them | security-auditor |

### `maxTurns`

Maximum number of agentic turns (API round-trips) before the agent stops. Prevents runaway token usage.

| Value | Used by |
|-------|---------|
| `50` | Domain agents and tester (may need many iterations) |
| `30` | Reviewer, security-auditor, doc-writer |
| `20` | Architect (analysis-focused) |
| none | Product-lead (unbounded — owns the full pipeline) |

### `memory: project`

All agents use `memory: project`, which enables persistent learnings stored in `.claude/agent-memory/`. Agents accumulate knowledge about the codebase across sessions.

### `skills`

Each agent has a core skill preloaded, matching its primary function:

| Agent | Skill | Purpose |
|-------|-------|---------|
| frontend-dev, backend-dev, infra-ops | `commit`, `context7` | Conventional Commits + library docs |
| doc-writer | `commit`, `context7` | Conventional Commits + library docs |
| reviewer | `review`, `commit`, `agent-browser` | Code review + fix + commit + deployed verification |
| tester | `test`, `context7` | Test generation + library docs |
| architect | `plan`, `adr`, `commit`, `context7` | Planning, ADRs, commits, library docs |
| product-lead | `interview`, `issue-triage`, `issues`, `adr`, `commit`, `pr`, `scaffold`, `agent-browser`, `context7`, `1b1`, `bootstrap` | Full product ownership toolkit |
| security-auditor | — | No skill (pure analysis) |

### `disallowedTools`

Defense-in-depth: even if an agent's `tools` list doesn't include certain tools, `disallowedTools` provides an explicit deny list as an extra safety layer:

| Agent | Disallowed |
|-------|------------|
| security-auditor | Write, Edit |

---

## Playbooks

### Playbook 1: Frontend Feature

**Scenario:** Add a new page with components, no API changes.

```bash
# 1. Create worktree
git worktree add ../roxabi-XXX -b feat/XXX-slug staging
cd ../roxabi-XXX && bun install

# 2. Start Claude Code and spawn agents
claude
/teammates add frontend-dev tester
```

**Task flow:**

```
[frontend-dev: Implement page + components]
        │
        └──→ [tester: Write component tests]
        │
        └──→ Commit & PR
        │
        └──→ /review (spawns reviewer on the PR)
```

**As the lead, you:**
1. Describe the feature and create the task list
2. frontend-dev implements the UI
3. tester writes tests once implementation is done
4. Create the PR
5. Run `/review` — reviewer fixes issues, commits, pushes, and waits for CI
6. Product-lead merges once reviewer confirms CI is green

### Playbook 2: Full-Stack Feature

**Scenario:** New API endpoint + frontend page that consumes it.

```bash
/teammates add frontend-dev backend-dev tester
```

**Task flow:**

```
[backend-dev: Implement API endpoint + types]
        │
[frontend-dev: Implement UI consuming the API]
        │
   [tester: Write tests]
        │
   Commit & PR
        │
   /review (spawns reviewer on the PR)
```

**As the lead, you:**
1. Create tasks with dependencies — frontend is blocked by backend (needs the API and types)
2. backend-dev implements the endpoint and shared types
3. frontend-dev implements the UI once the API is ready
4. tester writes tests for the completed code
5. Create the PR
6. Run `/review` — reviewer fixes issues, commits, pushes, and waits for CI
7. Product-lead merges once reviewer confirms CI is green

### Playbook 3: Bug Fix with Validation

**Scenario:** Backend bug that needs a fix and regression test.

```bash
/teammates add backend-dev tester
```

**Task flow:**

```
[backend-dev: Fix the bug]
        │
[tester: Write regression test]
        │
Commit & PR
        │
/review (spawns reviewer on the PR)
```

**As the lead, you:**
1. Describe the bug with reproduction steps
2. backend-dev investigates and fixes
3. tester writes a regression test that would have caught it
4. Create the PR
5. Run `/review` — reviewer fixes issues, commits, pushes, and waits for CI
6. Product-lead merges once reviewer confirms CI is green

### Playbook 4: Large Feature (Full Team with Bootstrap)

**Scenario:** Major feature spanning frontend, backend, and infrastructure.

**Phase 1 — Bootstrap (planning):**

```bash
/bootstrap
# Spawns: product-lead, architect, doc-writer
# Outputs: spec, issue, analysis
```

**Phase 2 — Implementation:**

```bash
/teammates add architect frontend-dev backend-dev infra-ops tester doc-writer
# Add security-auditor if security-sensitive
```

**Task flow:**

```
[architect: Design + break into tasks]
        │
   ┌────┼────────┐
[front] [back] [infra]     ← parallel implementation
   └────┼────────┘
        │
   ┌────┼────┐
[tester] [security-auditor]  ← parallel verification
        │
   [doc-writer: Update docs]
        │
   Commit & PR
        │
   /review (spawns reviewer on the PR)
```

**As the lead, you:**
1. Run `/bootstrap` — product-lead gathers requirements, architect designs the system, doc-writer drafts the spec
2. Let architect design the approach and create the task dependency graph
3. Domain agents implement in parallel (each in their own packages)
4. tester and security-auditor verify in parallel once implementation is complete
5. doc-writer updates documentation
6. Create the PR
7. Run `/review` — reviewer fixes issues, commits, pushes, and waits for CI
8. Product-lead merges once reviewer confirms CI is green

---

## Coordination Rules

All agents follow these rules (baked into their system prompts):

1. **Stay in your domain** — Never modify files outside your assigned packages
2. **Claim, don't grab** — Pick tasks from the shared task list, don't create your own
3. **Report blockers** — If stuck, message the lead with a clear description
4. **Hand off properly** — When done, mark your task complete and create tasks for the next agent
5. **Escalate cross-domain needs** — If you need changes in another domain, create a task for that agent

## Plugins

Claude Code plugins are enabled in `.claude/settings.json` and extend agent capabilities:

| Plugin | Purpose | Benefits |
|--------|---------|----------|
| `vercel@claude-plugins-official` | Vercel deployment management | All agents can check deployments |
| `frontend-design@claude-plugins-official` | Design guardrails for UI development | Helps frontend-dev avoid AI-generated design slop |

### Built-in Tools

`AskUserQuestion` is a built-in tool always available to all agents, regardless of the `tools:` field in their definition. It does not need to be listed explicitly.

---

## Model Tiering (Future)

Recommended model-per-role mapping for cost optimization. **Not applied yet** — all agents currently use `model: inherit`.

| Tier | Model | Agents | Rationale |
|------|-------|--------|-----------|
| **Heavy** | Opus | product-lead, architect | Complex analysis, planning, product decisions |
| **Standard** | Sonnet | frontend-dev, backend-dev, infra-ops, tester, doc-writer | Implementation, testing, documentation |
| **Light** | Haiku | reviewer, security-auditor | Read-only analysis, checklist verification |

This tiering will be applied when cost optimization becomes a priority. For now, all agents inherit the parent session's model.

---

## Troubleshooting

| Problem | Solution |
|---------|----------|
| Agent modifies wrong files | Check its `.claude/agents/*.md` boundaries section. Remind it of its domain. |
| Agent doesn't claim tasks | Make sure the task description matches the agent's domain keywords. |
| Context window exhausted | Restart the agent. The task list persists across sessions. |
| Agent teams feature not working | Verify `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` is set. Check Claude Code version. |
| Two agents conflict on a file | Add a `blockedBy` dependency to serialize access. |
| Too expensive for small tasks | Use subagents (Task tool) for Tier S. Reserve full Agent Teams for Tier F multi-domain. |

## Fallback: Single Agent Mode

If agent teams are unstable or unavailable, the agent `.md` files still work as reference documents. You can:

1. Use a single Claude Code session
2. Read the relevant agent's `.md` file for domain context
3. Follow the same boundaries and standards manually

The agent definitions are designed to be useful both as agent team prompts and as human reference guides.
