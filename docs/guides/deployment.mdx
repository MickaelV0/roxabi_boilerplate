---
title: Deployment
description: Deploy Roxabi on Vercel — both web and API on one platform
---

## Overview

Roxabi uses a push-to-deploy architecture with **Vercel** as the single deployment platform for both the web app and API.

```
Push to main
  -> GitHub Actions CI (lint, typecheck, test)
  -> Vercel auto-deploys web app (TanStack Start)
  -> Vercel auto-deploys API (NestJS — zero-config support)
```

| Component | Platform | Details |
|-----------|----------|---------|
| Web (TanStack Start + Nitro) | Vercel | SSR, edge caching, Fluid compute |
| API (NestJS + Fastify) | Vercel | Zero-config NestJS, Fluid compute, auto-scaling |
| Database | OVH CloudDB | External PostgreSQL, not managed by Vercel |

No Docker is needed for deployment. Docker configurations (Dockerfiles, `docker-compose.prod.yml`, Nginx configs, `deploy/`) remain in the repo for local development only.

---

## Prerequisites

Install the Vercel CLI globally:

```bash
bun add -g vercel
```

Authenticate:

```bash
vercel login
```

---

## Initial Setup

You need **two Vercel projects** pointing to the same GitHub repository — one for the web app and one for the API.

### 1. Create Projects

Create both projects from the Vercel dashboard (one-time setup):

1. Sign up at [vercel.com](https://vercel.com) and connect your GitHub account
2. Click **Add New Project**, import the repository, set Root Directory to `apps/web`
3. Repeat for `apps/api`

Build settings are version-controlled in `apps/web/vercel.json` and `apps/api/vercel.json` — no manual configuration needed.

### 2. Link Projects Locally

Link each app directory to its Vercel project:

```bash
cd apps/web && vercel link
cd apps/api && vercel link
```

Select the matching project when prompted. This creates `.vercel/project.json` in each directory (gitignored).

### 3. Configure Environment Variables

#### Web project

```bash
cd apps/web
for env in production preview development; do
  echo "https://api.roxabi.vercel.app" | vercel env add API_URL "$env"
  echo "https://app.roxabi.vercel.app" | vercel env add APP_URL "$env"
done
```

| Variable | Description |
|----------|-------------|
| `API_URL` | Vercel API project URL |
| `APP_URL` | This project's URL |

#### API project

```bash
cd apps/api

# Generate auth secret
SECRET=$(openssl rand -base64 32)

for env in production preview development; do
  echo "https://app.roxabi.vercel.app" | vercel env add CORS_ORIGIN "$env"
  echo "$SECRET"                       | vercel env add BETTER_AUTH_SECRET "$env"
  echo "https://api.roxabi.vercel.app" | vercel env add BETTER_AUTH_URL "$env"
  echo "https://app.roxabi.vercel.app" | vercel env add APP_URL "$env"
  echo "https://api.roxabi.vercel.app" | vercel env add API_URL "$env"
  echo "noreply@yourdomain.com"        | vercel env add EMAIL_FROM "$env"
done
```

Add secrets interactively (values not stored in shell history):

```bash
vercel env add DATABASE_URL production
vercel env add RESEND_API_KEY production
```

| Variable | Description |
|----------|-------------|
| `DATABASE_URL` | PostgreSQL connection string |
| `CORS_ORIGIN` | Web project URL (for CORS) |
| `BETTER_AUTH_SECRET` | Random 32+ character string |
| `BETTER_AUTH_URL` | This project's URL |
| `APP_URL` | Web project URL |
| `API_URL` | This project's URL |
| `EMAIL_FROM` | Sender email address |
| `RESEND_API_KEY` | Resend API key for transactional emails |

### 4. Verify

```bash
cd apps/web && vercel env ls
cd apps/api && vercel env ls
```

---

## Daily Operations

### Check Deployment Status

```bash
cd apps/web && vercel ls    # Web deployments
cd apps/api && vercel ls    # API deployments
```

### View Logs

```bash
vercel logs &lt;deployment-url&gt;
```

### Inspect a Deployment

```bash
vercel inspect &lt;deployment-url&gt;
vercel inspect &lt;deployment-url&gt; --logs   # With build logs
```

### Rollback

```bash
vercel promote &lt;previous-deployment-url&gt;
```

Or find the URL first:

```bash
vercel ls                                  # Find the working deployment
vercel promote &lt;url&gt;                       # Promote it to production
```

### Redeploy

```bash
vercel redeploy
```

### Manage Environment Variables

```bash
vercel env ls                              # List all
vercel env add SECRET_NAME production      # Add (interactive)
vercel env rm SECRET_NAME production       # Remove
vercel env pull .env.local                 # Pull to local file
```

---

## Build Settings

Build settings are version-controlled in `vercel.json` files — no dashboard configuration needed.

**`apps/web/vercel.json`:**

```json
{
  "installCommand": "bun install",
  "buildCommand": "turbo run build"
}
```

**`apps/api/vercel.json`:**

```json
{
  "installCommand": "bun install",
  "buildCommand": "turbo run build"
}
```

Nitro (TanStack Start) outputs to `.vercel/output/` using the Vercel Build Output API — no `outputDirectory` override needed.

---

## Ignoring Paths (Avoid Duplicate Deploys)

Since both projects share the same repo, configure **Ignored Build Step** so each project only redeploys when its own code changes.

In each project's **Settings &gt; Git &gt; Ignored Build Step**, use:

**Web project:**
```bash
git diff --quiet HEAD^ HEAD -- apps/web/ packages/ docs/
```

**API project:**
```bash
git diff --quiet HEAD^ HEAD -- apps/api/ packages/types/
```

---

## Custom Domains

```bash
cd apps/web && vercel domains add app.yourdomain.com
cd apps/api && vercel domains add api.yourdomain.com
```

Then configure DNS with a CNAME record pointing to `cname.vercel-dns.com`. Vercel handles SSL certificates automatically.

---

## Important Notes

- Vercel automatically sets `NODE_ENV=production`
- NestJS runs as a [Vercel Function](https://vercel.com/docs/functions) with [Fluid compute](https://vercel.com/docs/fluid-compute) — auto-scaling, reduced cold starts
- Free tier: 10s execution limit per request. Pro tier: 60s
- 250MB max application size (Vercel Functions limitation)
- `API_URL` and `APP_URL` are declared in `turbo.json` build env to ensure Turbo invalidates cache when they change

---

## VPS Alternative

The repository includes Docker configurations for VPS-based deployment:

- Multi-stage Dockerfiles for API and web
- `docker-compose.prod.yml` for container orchestration
- Nginx reverse proxy configs in `deploy/nginx/`

If you have a VPS with Docker, you can use the Docker build/push/SSH deploy pipeline instead of Vercel. See the full specification at [docs/specs/52-vps-deployment.mdx](/docs/specs/52-vps-deployment).
