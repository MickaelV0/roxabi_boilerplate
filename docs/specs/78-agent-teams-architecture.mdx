---
title: "Agent Teams Architecture (Multi-Agent Swarm)"
description: Implement a 10-agent team architecture using Claude Code Agent Teams to replace the single-agent, skill-invoked model.
---

## Context

Roxabi Boilerplate operates as a monorepo with 16 Claude Code skills covering the full dev lifecycle. The current model is **single-agent, skill-invoked**: one Claude Code session handles everything sequentially, invoking skills as prompt templates.

This spec defines the transition to **Claude Code Agent Teams** — an experimental multi-agent coordination system where independent Claude Code sessions (teammates) work in parallel under a shared task list, each with dedicated roles, tools, and domain expertise.

**Promoted from:** [Agent Teams Architecture Analysis](../analyses/78-agent-teams-architecture)

**Dependencies:**
- Claude Code with experimental agent teams support (`CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1`)
- Existing 16 skills remain operational (coexistence model)

## Goal

Implement 10 specialized agents in `.claude/agents/` with clear role boundaries, tool access, model assignments, and system prompts. Define a tier-based routing decision tree so the human lead knows when to use agent teams vs a single agent. Ship as Phase 1 (human-led orchestration).

## Users &amp; Use Cases

### Primary user: Human developer (lead)

- **Tier S feature**: Developer works directly with a single Claude Code session (no agent teams). Business as usual.
- **Tier M feature**: Developer spawns 3-5 relevant agents (e.g., frontend-dev + backend-dev + reviewer). Coordinates via task list.
- **Tier L feature**: Developer spawns the full team or a large subset. Uses the task dependency graph pattern to orchestrate parallel work.

### Workflows

1. **Feature implementation**: Human creates task list → assigns to domain agents → quality agents review/test → doc-writer updates docs → PM creates PR.
2. **Bug fix (Tier M)**: Human spawns backend-dev + tester → backend-dev fixes → tester validates → reviewer checks.
3. **Spec review**: Human spawns architect + BA → they review the spec and provide feedback.

## Expected Behavior

### Happy path

1. Human enables `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` in environment.
2. Human consults the routing decision tree to determine which agents to spawn.
3. Human starts a Claude Code session (lead) and spawns teammates: `/teammates add frontend-dev backend-dev reviewer`.
4. Human creates a task list with dependencies (e.g., "implement API endpoint" blocks "write tests").
5. Teammates claim tasks matching their domain, execute within their boundaries, and report completion.
6. Human reviews deliverables at each gate (spec, implementation, test, PR).
7. Once all tasks are complete, human creates the PR.

### Edge cases

| Scenario | Behavior |
|----------|----------|
| Agent encounters a file outside its domain | Agent should **not** modify it. Instead, create a task for the appropriate domain agent and message the lead. |
| Two agents need to modify the same file | Domain boundaries prevent this in most cases. If unavoidable, the lead resolves by serializing the tasks (blockedBy dependency). |
| Agent hits context window limit | Agent reports to lead. Lead can restart the agent with a fresh context, passing the task list for continuity. |
| Agent teams feature is unstable/broken | Fallback to single-agent + subagent model. All agent prompts are also usable as subagent system prompts. |
| Tier S feature accidentally spawns full team | Decision tree prevents this. If it happens, the extra agents idle (no cost beyond initialization). |

## Constraints

- **Experimental feature**: Agent teams requires `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1`. May break with Claude Code updates.
- **Cost**: Token cost scales with number of agents. All agents use the default (inherited) model — no per-agent model overrides in v1.
- **No per-package CLAUDE.md files in v1**: Agents reference `docs/standards/*` directly. Per-package context files deferred to v2.
- **Phase 1 only**: Human is always the lead. Agent-led and autonomous phases are future work.
- **No custom MCP servers per agent in v1**.

## Non-goals

- Memory persistence across sessions (ENGRAM/Supermemory)
- Custom MCP servers per agent
- Phase 2 (agent-led) or Phase 3 (autonomous) orchestration
- Per-package CLAUDE.md files (`apps/web/CLAUDE.md`, `apps/api/CLAUDE.md`)
- Replacing existing skills — coexistence model, not replacement

## Technical Decisions

### 1. Agent Definition Format

Each agent is a Markdown file in `.claude/agents/` with YAML frontmatter:

```yaml
---
name: {agent-name}
description: "Use this agent when... Examples: ..."
model: inherit
color: {color}
tools: ["Tool1", "Tool2"]
---

{System prompt content}
```

**Frontmatter fields:**

| Field | Required | Description |
|-------|----------|-------------|
| `name` | Yes | kebab-case identifier (e.g., `frontend-dev`) |
| `description` | Yes | When to use this agent, with examples |
| `model` | Yes | `inherit` for all agents (uses whatever model the lead session uses) |
| `color` | Yes | Terminal color for identification |
| `tools` | No | Tool allowlist. Omit for all tools. |

### 2. Team Roster (10 Agents)

#### Tier 1 — Domain Agents (code writers)

| Agent | Model | Color | Tools | Primary Packages |
|-------|-------|-------|-------|-----------------|
| `frontend-dev` | inherit | cyan | Read, Write, Edit, Glob, Grep, Bash | `apps/web`, `packages/ui` |
| `backend-dev` | inherit | green | Read, Write, Edit, Glob, Grep, Bash | `apps/api`, `packages/types` |
| `devops` | inherit | yellow | Read, Write, Edit, Glob, Grep, Bash | `packages/config`, root configs |

#### Tier 2 — Quality Agents (verification)

| Agent | Model | Color | Tools | Scope |
|-------|-------|-------|-------|-------|
| `reviewer` | inherit | magenta | Read, Glob, Grep | All packages (read-only) |
| `tester` | inherit | blue | Read, Write, Edit, Glob, Grep, Bash | All packages |
| `security-auditor` | inherit | red | Read, Glob, Grep, Bash | All packages |

#### Tier 3 — Strategy Agents (planning &amp; alignment)

| Agent | Model | Color | Tools | Scope |
|-------|-------|-------|-------|-------|
| `architect` | inherit | white | Read, Glob, Grep, Bash | All packages |
| `business-analyst` | inherit | orange | Read, Glob, Grep, WebSearch | `docs/` |
| `product-manager` | inherit | purple | Read, Glob, Grep, Bash | `docs/`, GitHub issues |
| `doc-writer` | inherit | gray | Read, Write, Edit, Glob, Grep | `docs/`, `CLAUDE.md` |

### 3. System Prompt Structure

Every agent prompt follows this structure:

```markdown
# Role Definition
Who you are, your domain, your responsibility.

# Domain Context
Baked-in standards — either inline or as "MUST read {path}" directives.

# Deliverables
What you produce and in what format.

# Boundaries
What is out of scope. When to escalate to the lead or another agent.

# Coordination Rules
How to interact with teammates:
- Claim tasks from the shared task list
- Report completion by marking tasks done
- Message the lead for blockers or cross-domain needs
- Never modify files outside your domain
```

**Baked-in standards per agent:**

| Agent | Must read / bake in |
|-------|-------------------|
| `frontend-dev` | `docs/standards/frontend-patterns.mdx` |
| `backend-dev` | `docs/standards/backend-patterns.mdx` |
| `devops` | `docs/configuration.mdx` |
| `reviewer` | `docs/standards/code-review.mdx` |
| `tester` | `docs/standards/testing.mdx` |
| `security-auditor` | OWASP top 10 + `.claude/hooks/security-check.js` patterns |
| `architect` | `docs/architecture/` + tier classification (S/M/L) from `docs/processes/dev-process.mdx` |
| `business-analyst` | Interview question framework from `/interview` skill |
| `product-manager` | Issue triage logic + `docs/processes/issue-management.mdx` |
| `doc-writer` | `docs/contributing.mdx` (MDX formatting rules) |

### 4. Sample Agent: `frontend-dev`

This is the reference implementation. All other agents follow the same pattern.

```markdown
---
name: frontend-dev
description: |
  Use this agent for frontend implementation tasks in apps/web and packages/ui.
  Specializes in TanStack Start, React, and UI component development.

  <example>
  Context: User needs a new page or component implemented
  user: "Implement the user profile page"
  assistant: "I'll use the frontend-dev agent to implement the UI."
  </example>

  <example>
  Context: Frontend bug fix
  user: "The sidebar doesn't collapse on mobile"
  assistant: "I'll use the frontend-dev agent to fix the responsive behavior."
  </example>
model: inherit
color: cyan
tools: ["Read", "Write", "Edit", "Glob", "Grep", "Bash"]
---

# Frontend Developer Agent

You are the frontend development specialist for Roxabi Boilerplate.

## Your Domain
- `apps/web/` — TanStack Start application (routes, components, hooks)
- `packages/ui/` — Shared UI component library

## Standards
BEFORE writing any code, you MUST read:
- `docs/standards/frontend-patterns.mdx` — Component patterns, naming, file structure
- `docs/standards/testing.mdx` — Test patterns (when writing component tests)

## Deliverables
- React components following project conventions (named exports, co-located tests)
- Route handlers using TanStack Start patterns
- Commits using Conventional Commits format: `<type>(<scope>): <description>`

## Boundaries
- NEVER modify files in `apps/api/` or `packages/config/` — those belong to backend-dev and devops
- NEVER modify `docs/` — that belongs to doc-writer
- If you need an API endpoint or type change, create a task for backend-dev and message the lead
- If you encounter a security concern, message security-auditor

## Coordination
- Claim tasks from the shared task list that match your domain
- Mark tasks as complete when done
- If blocked, message the lead with the blocker description
- When your implementation is ready, create a task for reviewer and tester
```

### 5. Tier-Based Routing Decision Tree

The human lead uses this decision tree to determine which agents to spawn:

```
Is this a code change?
├── No (docs only) → doc-writer alone (or single agent)
└── Yes
    ├── Tier S (≤3 files, no arch risk)
    │   └── Single agent session (no agent teams)
    │
    ├── Tier M (3-10 files, local arch)
    │   ├── Frontend only? → frontend-dev + reviewer + tester
    │   ├── Backend only?  → backend-dev + reviewer + tester
    │   ├── Full-stack?    → frontend-dev + backend-dev + reviewer + tester
    │   └── + architect (if design decisions needed)
    │
    └── Tier L (>10 files, system arch)
        └── Full team or near-full team:
            ├── Always: architect + domain agents + reviewer + tester
            ├── If new feature: + business-analyst + product-manager
            ├── If security-sensitive: + security-auditor
            └── If docs impact: + doc-writer
```

**Quick reference:**

| Tier | Agents | Typical count |
|------|--------|---------------|
| S | None (single session) | 1 |
| M (frontend) | frontend-dev, reviewer, tester | 3 |
| M (backend) | backend-dev, reviewer, tester | 3 |
| M (full-stack) | frontend-dev, backend-dev, reviewer, tester | 4-5 |
| L | All relevant agents | 6-10 |

### 6. Skills Coexistence Model

| Behavior | Location | Rationale |
|----------|----------|-----------|
| Commit format, coding standards | Baked into domain agent prompts | 100% reliability |
| Review checklist, Conventional Comments | Baked into reviewer prompt | 100% reliability |
| Test patterns, coverage thresholds | Baked into tester prompt | 100% reliability |
| Complex workflows (/bootstrap, /scaffold, /interview) | Remain as skills | Too large to bake in |
| Utility operations (/cleanup, /1b1, /issues) | Remain as skills for human use | Agents don't need these |

### 7. Environment Configuration

Enable agent teams in the shell environment or `.env`:

```bash
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
```

No additional configuration files (e.g., `.claude/teams/`) are needed for v1. Agent definitions in `.claude/agents/` are auto-discovered by Claude Code.

### 8. File Structure

```
.claude/
  agents/
    frontend-dev.md
    backend-dev.md
    devops.md
    reviewer.md
    tester.md
    security-auditor.md
    architect.md
    business-analyst.md
    product-manager.md
    doc-writer.md
```

## Success Criteria

- [ ] All 10 agent `.md` files exist in `.claude/agents/` with correct frontmatter and system prompts
- [ ] Each agent has: role definition, domain context (standards refs), deliverables, boundaries, coordination rules
- [ ] `frontend-dev.md` matches the sample agent definition in this spec
- [ ] Remaining 9 agents follow the same structure, adapted to their domain
- [ ] Routing decision tree is documented in a discoverable location (CLAUDE.md or docs/)
- [ ] Environment variable `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` is documented in setup instructions
- [ ] Existing 16 skills continue to work unchanged
- [ ] A Tier M feature can be completed using 3-4 spawned agents (validation test)

## Open Questions

1. **maxTurns per agent**: Should agents have turn limits to prevent runaway token usage? If so, what are reasonable defaults per tier? (Suggested: domain=50, quality=30, strategy=20)
2. **Permission mode**: Should domain agents use `acceptEdits` (auto-approve edits) or `default` (prompt for each)? `acceptEdits` is faster but riskier for v1.
3. **Agent teams CLI stability**: The feature is experimental. What is the fallback plan if Anthropic changes the API? (Suggested: agent .md files double as subagent system prompts with minimal adaptation.)
