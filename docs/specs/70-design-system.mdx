---
title: "Design System Page & Theme Customization"
description: Public design system page with interactive component playground, theme editor, preset themes, and localStorage persistence.
---

## Context

Issue #48 (UI Component Library) is complete: Shadcn/UI is configured, 19 components live in `packages/ui`, and light/dark mode works via OKLch CSS variables. However, there is no visible design system page, no interactive playground to explore components, and no theme customization beyond the light/dark toggle.

This spec covers **Phase 1**: a public `/design-system` page with an interactive component playground, a live theme editor, preset themes, and localStorage persistence.

**Promoted from:** [#70 Design System & Theme Customization Analysis](/docs/analyses/70-design-system)

**Dependency:** #48 UI Component Library — **CLOSED**.

**Blocks:** Phase 2 (theme API + DB persistence, depends on #19 Auth), Phase 3 (admin panel embed, depends on #25 Admin).

**Tier: L** — >10 files across `packages/ui` (themes, helpers, types) and `apps/web` (route, 5+ components, compositions). Requires full spec + worktree.

## Goal

Deliver a public `/design-system` page that lets developers:
- Browse all 20 `@repo/ui` components with interactive prop controls
- Customize the full theme (colors, typography, radius, shadows) in real-time
- Switch between 4 preset themes
- Persist custom themes in localStorage across page reloads
- Copy composition patterns (auth forms, feedback, data display) for rapid development

## Users & Use Cases

| User | Use Case |
|------|----------|
| Developer (internal) | Explore available components, test prop combinations, copy code snippets |
| Developer (internal) | Customize the theme to match a brand, preview changes live |
| Developer (internal) | Select a preset theme as a starting point, then fine-tune |
| Developer (internal) | View composition patterns (login form, stat card) and copy them into features |
| Future: Admin (Phase 3) | Customize branding via admin panel (reuses ThemeEditor component) |

## Expected Behavior

### Happy path

1. User navigates to `/design-system` (public route, no auth required).
2. Page loads with the default theme. If a custom theme exists in localStorage, it is applied instantly (blocking script in `&lt;head>` prevents FOUC).
3. Page displays tabbed content sections: Colors, Typography, Spacing & Radius, Components, Compositions.
4. A collapsible **Theme Editor** sidebar panel is available (toggle button).
5. In the theme editor, user can:
   - Pick colors via hex color pickers (8 semantic tokens: primary, secondary, accent, destructive, muted, background, foreground, border).
   - Select font family from a dropdown.
   - Adjust base font size via slider.
   - Adjust border radius via slider (auto-calculates sm/md/lg/xl variants).
   - Select shadow preset (none, subtle, medium, strong).
6. All changes apply instantly via `CSS.setProperty()` — no rebuild needed.
7. For each seed color, a lightweight contrast indicator shows whether the foreground/background pair meets WCAG AA (4.5:1 for normal text). Failing pairs display a warning icon (non-blocking — the user can still save the theme). Contrast is computed from the derived OKLch values using the relative luminance formula.
8. User can select a preset theme (Default, Ocean, Warm, Minimal) — all controls update to the preset values.
9. User can click "Reset to default" to restore the original zinc-based theme.
10. Custom theme auto-saves to localStorage on every change.
11. In the Components section, each component has:
    - A rendered preview area.
    - Prop controls (variant, size, disabled, etc.) to toggle interactively.
    - A code snippet showing the current prop configuration.
12. In the Compositions section, pre-built patterns are displayed using real `@repo/ui` components.

### Edge cases

| Scenario | Behavior |
|----------|----------|
| localStorage is full or unavailable | Gracefully degrade — theme editor works but changes don't persist. No error shown to user. |
| Corrupt JSON in localStorage | Ignore stored theme, fall back to default. Clear the corrupt entry. |
| User switches between light/dark mode while custom theme is active | `deriveFullTheme()` produces both light and dark variable sets. Light values are set on `:root`, dark values on `.dark`, both via inline `style` (highest specificity). Toggling dark mode shows the derived dark palette automatically. |
| Browser with JS disabled | Page renders with default theme. Theme editor and interactive controls are non-functional (acceptable — this is a dev tool). |
| Window resize / mobile viewport | Below 1024px, the theme editor sidebar becomes a slide-over overlay panel from the right (triggered by the same toggle button). A semi-transparent backdrop dismisses it on click. Component showcase sections stack vertically. |
| Component has no configurable props | Show the component rendered with default props. Hide the prop controls panel. |

## Constraints

- **No backend dependency**: Phase 1 is purely client-side. No API calls, no auth required.
- **OKLch preservation**: All color values stored and applied as OKLch. Hex is only used in the color picker UI, converted via `culori`.
- **Existing component library**: Must render actual `@repo/ui` components — no duplicated or mocked components.
- **Bundle size**: `culori` is tree-shakeable (estimated ~8KB gzip for the required imports: `oklch`, `rgb`, `formatHex`, `parse`). Must be verified during implementation — if the tree-shaken bundle exceeds 15KB gzip, evaluate extracting only the needed conversion functions manually.
- **TanStack Start routing**: Route must follow the existing `apps/web/src/routes/` conventions.
- **Shadcn CSS variable architecture**: Must work within the existing `theme.css` variable system. No changes to the CSS variable naming scheme.
- **Accessibility**: The design system page must itself follow accessible patterns:
  - **Keyboard navigation**: All interactive controls (color pickers, sliders, tabs, preset buttons) must be reachable and operable via keyboard. Tab order must follow logical reading order.
  - **Focus management**: Opening/closing the theme editor sidebar must move focus to the sidebar / return focus to the trigger button. Focus trapping is not required (sidebar is not a modal).
  - **ARIA labels**: Color pickers must have `aria-label` with the token name (e.g., "Primary color"). Sliders must have `aria-valuetext`. Tabs must use `role="tablist"` / `role="tab"` / `role="tabpanel"`.
  - **Screen reader announcements**: Preset theme selection and reset actions should announce the result via `aria-live="polite"` region.
- **Performance**: The page is content-heavy (19 component showcases + 6 compositions + theme editor + code snippets). To keep it snappy:
  - Tab section content (Colors, Typography, Spacing, Components, Compositions) must be **lazy-rendered** — only the active tab's content is mounted. Use `React.lazy()` or conditional rendering.
  - Code snippets (shiki) must be rendered **on-demand** (when the code tab is expanded or visible), not eagerly for all components at once.
  - The `/design-system` route should be **code-split** from the main app bundle (TanStack Router handles this by default for file-based routes).

## Non-goals

- **Theme import/export (JSON)**: Deferred. Could be added to any future phase.
- **Full WCAG contrast checker**: A comprehensive audit tool is deferred. Phase 1 includes a lightweight contrast warning indicator (see Expected Behavior).
- **Database persistence / API**: Phase 2 (requires Auth #19).
- **Admin panel integration**: Phase 3 (requires Admin Panel #25).
- **Asset uploads (logo, favicon)**: Phase 3 (requires Admin Panel #25 + File Uploads #59).
- **Storybook or external playground**: Intentionally avoided. Custom-built is lighter and in-app.
- **Theme SSR / server-side application**: Phase 1 is client-only. SSR theme application is a Phase 2 concern.

## Technical Decisions

### 1. Custom-built playground (not Storybook)

A custom `ComponentShowcase` wrapper is lighter, lives inside the app, and requires no extra build tooling. Storybook adds 100MB+ of dependencies and a separate build process.

### 2. Live preview via CSS.setProperty() with dual-mode derivation

User edits seed colors for the current mode. `deriveFullTheme()` auto-derives the opposite mode's palette by inverting OKLch lightness (trivial in OKLch color space). Light values are applied via `document.documentElement.style.setProperty()` on `:root`, dark values are applied to the `.dark` selector. Inline styles have the highest specificity, overriding both `:root` and `.dark` stylesheet rules. This ensures both modes always look correct from a single set of seed inputs.

### 3. FOUC prevention with inline script component

Dark/light mode FOUC prevention is already handled by `next-themes` (via fumadocs `RootProvider`), which injects an inline `&lt;script>` as a React component inside `&lt;body>`. The custom theme uses the **same pattern**: a `ThemeScript` React component with `dangerouslySetInnerHTML` rendered at the top of `AppShell` (before any visual content). This runs synchronously before the browser paints the tree.

```
<ThemeScript /> → inline script → read localStorage("roxabi-theme") → parse JSON → setProperty() for both :root and .dark variables → done before first paint
```

No modification to `&lt;HeadContent />` or `__root.tsx` `&lt;head>` is needed.

### 4. Color conversion with culori

`culori` provides hex ↔ OKLch conversion. It's tree-shakeable (estimated ~8KB gzip — to be verified at implementation time; 15KB budget cap), well-maintained, and has excellent OKLch support. Color pickers use hex for UX; all storage and application use OKLch.

### 5. Preset themes as TypeScript config objects

Four preset themes (Default, Ocean, Warm, Minimal) are defined as `ThemeConfig` objects in `packages/ui/src/themes/`. "Reset to default" simply applies the Default preset. This keeps theme data type-safe and co-located with the UI package.

### 6. ThemeConfig type (seed + derive)

The theme editor exposes 8 **seed colors**. All other CSS variables are **derived automatically** via `deriveFullTheme()`. This keeps the editor UX simple while producing a complete theme.

```typescript
interface ThemeConfig {
  name: string
  colors: {
    primary: string       // OKLch value — seed
    secondary: string     // OKLch value — seed
    accent: string        // OKLch value — seed
    destructive: string   // OKLch value — seed
    muted: string         // OKLch value — seed
    background: string    // OKLch value — seed
    foreground: string    // OKLch value — seed
    border: string        // OKLch value — seed
  }
  typography: {
    fontFamily: string
    baseFontSize: string  // e.g., "16px"
  }
  radius: string          // e.g., "0.625rem"
  shadows: "none" | "subtle" | "medium" | "strong"
}
```

#### Derivation rules

`deriveFullTheme(config: ThemeConfig)` produces all 30+ CSS variables from the 8 seeds.

All formulas use OKLch coordinates: `L` (lightness, 0–1), `C` (chroma, 0–0.4), `H` (hue, 0–360).

| Derived variable | Formula |
|------------------|---------|
| `*-foreground` (primary, secondary, accent, destructive, muted) | `L' = clamp(1 - L, 0.15, 0.95)`. If `|L' - L| &lt; 0.4`, force `L' = L > 0.5 ? 0.15 : 0.95`. Chroma and hue preserved from seed. |
| `card`, `popover` | Copy `background` values directly. |
| `card-foreground`, `popover-foreground` | Copy `foreground` values directly. |
| `input` | Copy `border` values directly. |
| `ring` | Same L/C/H as `border`, with alpha channel set to `50%` (e.g., `oklch(L C H / 0.5)`). |
| `sidebar` | `L' = background.L ± 0.03` (subtract in light mode, add in dark mode). Same C/H as `background`. |
| `sidebar-foreground` | Copy `foreground` values directly. |
| `sidebar-primary`, `sidebar-primary-foreground` | Copy from `primary` / derived `primary-foreground`. |
| `sidebar-accent`, `sidebar-accent-foreground` | Copy from `accent` / derived `accent-foreground`. |
| `sidebar-border`, `sidebar-ring` | Copy from `border` / derived `ring`. |
| `chart-1` through `chart-5` | `H' = (primary.H + N * 60) % 360` where N = 0..4. Same L and C as `primary`. If any chart hue falls within ±15° of a seed color's hue, shift by +30° to avoid visual collision. |

**Dark mode derivation:** `deriveFullTheme()` produces both light and dark variable sets from the same seeds. For the opposite mode, each seed's lightness is mirrored: `L_dark = clamp(1 - L_light, 0.1, 0.95)`. Chroma is preserved. All derivation rules above are then applied to the mirrored seeds.

Variables not listed above are **not user-editable in Phase 1** and retain their default values.

### 7. File architecture & ownership boundaries

**`packages/ui`** owns: `ThemeConfig` type, preset theme data, derivation logic (`deriveFullTheme`), and CSS variable application helpers (`applyTheme`, `resetTheme`). This package has no knowledge of persistence (localStorage, API, etc.).

**`apps/web`** owns: persistence (localStorage in Phase 1, API calls in Phase 2), the editor UI, the design system page, and all route-level components. Serialization (JSON ↔ `ThemeConfig`) lives here, not in `packages/ui`.

```
apps/web/src/routes/
└── design-system/
    ├── index.tsx              # Main layout: sidebar + content
    ├── -components/
    │   ├── ThemeEditor.tsx    # Side panel with token controls
    │   ├── ColorPicker.tsx    # Hex picker + OKLch conversion
    │   ├── ComponentShowcase.tsx  # Wrapper for interactive preview
    │   ├── CodeSnippet.tsx    # Syntax-highlighted usage example
    │   └── compositions/
    │       ├── AuthForms.tsx
    │       ├── FeedbackPatterns.tsx
    │       └── DataDisplay.tsx

packages/ui/src/
├── themes/
│   ├── index.ts               # Re-exports all presets
│   ├── default.ts
│   ├── ocean.ts
│   ├── warm.ts
│   └── minimal.ts
└── lib/
    └── theme.ts               # ThemeConfig type + derive/apply/reset helpers (no persistence)
```

## Component Delivery Waves

Components are split into two waves based on complexity. Wave 1 ships with Phase 1; Wave 2 can follow as a fast follow-up.

### Wave 1 — Simple components (Phase 1)

Static or single-element components with straightforward props (variant, size, disabled):

| Component | Key props |
|-----------|-----------|
| Button | variant, size, disabled |
| Badge | variant |
| Input | type, placeholder, disabled |
| Label | — |
| Textarea | placeholder, disabled |
| Checkbox | checked, disabled |
| Switch | checked, disabled |
| Separator | orientation |
| Skeleton | className (size) |
| Slider | min, max, step, disabled |
| Avatar | src, fallback |
| Card | — (showcase with CardHeader, CardContent, CardFooter) |

### Wave 2 — Compound components (follow-up)

Multi-part components with portals, controlled state, or nested sub-components:

| Component | Complexity note |
|-----------|----------------|
| Dialog | Portal, open/close state, overlay |
| DropdownMenu | Portal, nested items, keyboard nav |
| Select | Portal, controlled/uncontrolled, search |
| Accordion | Multi-item state, collapsible |
| NavigationMenu | Nested sub-menus, viewport positioning |
| HoverCard | Portal, hover timing, positioning |
| Tooltip | Portal, positioning, delay |

Wave 2 components are shown in the showcase with **default rendering only** (no interactive prop controls) until their full playground is built.

## Composition Patterns

6 compositions across 3 categories (2 per category):

| Category | Phase 1 Patterns | Deferred |
|----------|-----------------|----------|
| **Auth forms** | Login form, Signup form | Forgot password form |
| **Feedback** | Toast/alert notification, Empty state | Error page |
| **Data display** | Stat card, Profile card | Simple table |

Compositions use real `@repo/ui` components with realistic (but static) data.

## Phase Roadmap

| Phase | Scope | Depends on | Status |
|-------|-------|------------|--------|
| **Phase 1 (this spec)** | `/design-system` page + playground + theme editor (localStorage) | #48 ✅ | To do |
| **Phase 2** | Theme API endpoint + DB persistence | #19 Auth | Blocked |
| **Phase 3** | Admin panel embed + asset uploads (logo, favicon) | #25 Admin + #59 File Uploads | Blocked |
| **Future** | Theme import/export JSON, WCAG contrast checker | None | Backlog |

## Success Criteria

- [ ] `/design-system` page is publicly accessible (no auth required)
- [ ] Theme editor sidebar updates all components in real-time via CSS variable overrides
- [ ] 4 preset themes (Default, Ocean, Warm, Minimal) can be selected and applied
- [ ] "Reset to default" restores the original zinc-based theme
- [ ] Wave 1 components (12) are showcased with interactive prop controls and code snippets
- [ ] Wave 2 components (7) are showcased with default rendering (interactive controls deferred)
- [ ] 6 composition patterns displayed: login form, signup form, toast/alert, empty state, stat card, profile card
- [ ] Custom theme persists in localStorage across page reloads
- [ ] No FOUC when loading a custom theme (inline `ThemeScript` component, same pattern as next-themes)
- [ ] Color pickers use hex with OKLch conversion via `culori`
- [ ] Theme editor is responsive (collapses on narrow viewports)
- [ ] Unit tests for `deriveFullTheme()`, `applyTheme()`, `loadTheme()`, `resetTheme()` helpers
- [ ] Unit tests for hex ↔ OKLch conversion logic
- [ ] Component tests for ThemeEditor (color picker interaction, preset selection, reset)
- [ ] Component test for ComponentShowcase (prop controls update preview)
- [ ] Contrast warning indicator on seed color pairs that fail WCAG AA (4.5:1)
- [ ] All interactive controls are keyboard-accessible (tab, enter/space, arrow keys for sliders)
- [ ] Focus moves to sidebar on open and returns to trigger on close
- [ ] Color pickers and sliders have descriptive `aria-label` attributes
- [ ] Preset selection and reset announce result via `aria-live` region
- [ ] Visual QA: manual verification of all 4 preset themes in both light and dark mode (8 screenshots captured in PR for reviewer reference)
- [ ] Visual QA: theme editor sidebar renders correctly at desktop (≥1024px) and mobile (&lt;768px) viewports

## Resolved Decisions

| Question | Decision | Rationale |
|----------|----------|-----------|
| Code snippet library | **shiki** | Already a project dependency via Fumadocs. However, shiki may only be bundled into the docs route — verify it doesn't add significant weight to the `/design-system` route chunk. If shiki's chunk exceeds 100KB gzip for the design-system route, fall back to a CSS-only syntax theme with `&lt;pre>&lt;code>` and class-based token coloring. Load shiki lazily (dynamic import) regardless. |
| Copy code button | **Yes** | Standard DX pattern. `navigator.clipboard.writeText()` with checkmark confirmation. |
| Theme editor position | **Right side** | Matches DevTools/Figma patterns. Content flows left-to-right. |
| Component organization | **By category** | Groups: Inputs, Feedback, Layout, Data Display, Navigation. Easier discovery. |
