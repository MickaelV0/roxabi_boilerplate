---
title: "Documentation & Onboarding Improvements"
description: Spec for Mermaid support, .env.example enrichment, ubiquitous language glossary, demo GIF with Playwright recording, and ASCII-to-Mermaid migration.
---

## Context

The [repo comparison analysis](../analyses/repo-comparisons/163-consolidated-summary) (epic #163) identified documentation gaps across 16 public repositories. The approved [analysis for #226](../analyses/226-documentation-onboarding) scoped improvements to developer onboarding and documentation quality.

**Promoted from:** [Documentation &amp; Onboarding Improvements (Analysis)](../analyses/226-documentation-onboarding)

**GitHub issue:** #226
**Parent epic:** #163

**Note:** This spec introduces Task 4 (ASCII-to-Mermaid migration) beyond the analysis scope — added during the spec interview as a natural complement to Mermaid support. Task numbering differs from the analysis (ubiquitous language moved to Task 2, demo GIF to Task 3) to reflect dependency ordering.

## Goal

Reduce onboarding friction for new developers and improve documentation quality by: enabling Mermaid diagram rendering in Fumadocs, enriching `.env.example` with clear grouping and worked examples, creating a ubiquitous language glossary with state machine diagrams, adding a reproducible demo GIF to the README, and migrating existing ASCII diagrams to Mermaid.

## Users &amp; Use Cases

| User | Use Case |
|------|----------|
| **New developer evaluating roxabi** | Sees the demo GIF in the README and understands what the product does in &lt;10 seconds without cloning |
| **New developer setting up locally** | Copies `.env.example`, reads the required/optional markers and inline comments, runs `bun dev` within minutes |
| **Developer reading architecture docs** | Looks up a domain term in the ubiquitous language glossary to resolve ambiguity (e.g., "Tenant" vs "Organization") |
| **AI agent (Claude Code)** | References the ubiquitous language glossary to use consistent terminology in generated code and docs |
| **Doc author** | Uses Mermaid syntax for diagrams instead of ASCII art, getting rendered visual output in Fumadocs |

## Expected Behavior

### Task 0: Add Mermaid Support to Fumadocs (XS)

#### Happy path

1. Install a Mermaid rendering plugin compatible with Fumadocs MDX
2. Configure the plugin in `apps/web/source.config.ts` via `remarkPlugins` or `rehypePlugins`
3. Existing Mermaid code blocks (e.g., in `docs/analyses/00-infrastructure-setup-summary.mdx`) render as SVG diagrams instead of plain code
4. New Mermaid blocks can be authored in any `.mdx` file and render correctly

#### Technical approach — Client-side (decided)

Use the [Fumadocs-recommended client-side approach](https://www.fumadocs.dev/docs/markdown/mermaid):

1. **Install** `mermaid` (`next-themes` is already installed)
2. **Create** a `<Mermaid>` client component at `apps/web/src/components/mdx/mermaid.tsx` that:
   - Uses `mermaid.render()` to generate SVG
   - Reads theme from `next-themes` (`useTheme()`) and applies `dark` or `default` Mermaid theme
   - Handles hydration correctly (render only after mount)
3. **Register** the component in `apps/web/src/mdx-components.tsx`
4. **Add** `remarkMdxMermaid` from `fumadocs-core/mdx-plugins` to `source.config.ts` → `defineConfig({ mdxOptions: { remarkPlugins: [remarkMdxMermaid] } })` to auto-convert ` ```mermaid ` code blocks to `<Mermaid>` component calls

**Why client-side over build-time:**
- Fumadocs officially documents this approach
- `next-themes` (already installed) provides native dark mode switching
- No headless browser dependency (~300MB saved from build environment)
- Compatible with `async: true` lazy MDX loading (no SSR rendering issues)
- Avoids OOM risk during Vercel builds (see [#234](https://github.com/MickaelV0/roxabi_boilerplate/issues/234))
- Tradeoff: ~200KB added to client bundle (acceptable for a docs site)

#### Edge cases

- **Build-time approach + OOM**: If the headless browser required for build-time rendering causes memory issues during Vercel builds, fall back to client-side rendering
- **Mermaid syntax errors**: Invalid Mermaid blocks should show a clear error message rather than breaking the entire page. The plugin should handle errors gracefully.
- **Dark mode**: The client-side `<Mermaid>` component reads the current theme from `next-themes` and passes it to `mermaid.initialize({ theme })`. Verify that switching themes re-renders diagrams correctly.

### Task 1: Enrich `.env.example` (XS)

#### Happy path

1. Developer clones the repo
2. Runs `cp .env.example .env`
3. Reads the file — sees clear section headers, required/optional markers, and inline comments
4. Starts `bun dev` with zero or minimal modifications (default values work for local dev)

#### Structure

```bash
# ═══════════════════════════════════════════════════════════════
# Roxabi Boilerplate — Environment Configuration
# ═══════════════════════════════════════════════════════════════
# Copy this file to .env and fill in the values.
# Uncommented vars are REQUIRED for local dev.
# Commented vars are OPTIONAL (enable as needed).
# ═══════════════════════════════════════════════════════════════

# ─── Application (Required) ──────────────────────────────────
WEB_PORT=3000              # Frontend dev server port
PORT=4000                  # API dev server port
APP_URL=http://localhost:3000   # Frontend URL (used for redirects, emails)
API_URL=http://localhost:4000   # API URL (used by frontend for API calls)
CORS_ORIGIN=http://localhost:3000  # Must match APP_URL exactly
LOG_LEVEL=debug            # debug | info | warn | error

# ─── Database (Required) ─────────────────────────────────────
# On Vercel: auto-injected by Neon Marketplace integration
DATABASE_URL=postgresql://roxabi:roxabi@localhost:5432/roxabi

# ─── Authentication (Required) ───────────────────────────────
BETTER_AUTH_SECRET=change-me-to-a-random-32-char-string  # Generate: openssl rand -hex 16
BETTER_AUTH_URL=http://localhost:4000  # Must point to the API, not the web app

# ─── Authentication — OAuth Providers (Optional) ─────────────
# Enable social login by uncommenting and filling in credentials
# GOOGLE_CLIENT_ID=
# GOOGLE_CLIENT_SECRET=
# GITHUB_CLIENT_ID=
# GITHUB_CLIENT_SECRET=

# ─── Email — Resend (Optional) ───────────────────────────────
# On Vercel: auto-injected by Resend Marketplace integration
# RESEND_API_KEY=
EMAIL_FROM=noreply@yourdomain.com

# ─── Rate Limiting — Upstash Redis (Optional) ────────────────
# On Vercel: auto-injected by Upstash Marketplace integration
# Required for rate limiting to work; without these, rate limiting is disabled
# KV_REST_API_URL=
# KV_REST_API_TOKEN=
# RATE_LIMIT_ENABLED=true
# SWAGGER_ENABLED=true
# RATE_LIMIT_GLOBAL_TTL=60000      # ms — global rate limit window
# RATE_LIMIT_GLOBAL_LIMIT=60       # requests per window
# RATE_LIMIT_AUTH_TTL=60000         # ms — auth endpoint window
# RATE_LIMIT_AUTH_LIMIT=5           # auth requests per window
# RATE_LIMIT_AUTH_BLOCK_DURATION=300000  # ms — block duration after limit hit
# RATE_LIMIT_API_TTL=60000          # ms — general API window
# RATE_LIMIT_API_LIMIT=100          # API requests per window

# ─── Claude Code (Optional) ──────────────────────────────────
CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1  # Enable multi-agent coordination

# ─── External Services (Optional) ────────────────────────────
# GITHUB_TOKEN=
# OPENAI_API_KEY=
# ANTHROPIC_API_KEY=

# ─── Public (Exposed to Client) ──────────────────────────────
VITE_ENABLE_DEMO=true
VITE_GITHUB_REPO_URL=https://github.com/MickaelV0/roxabi_boilerplate

# ═══════════════════════════════════════════════════════════════
# Configuration Examples
# ═══════════════════════════════════════════════════════════════

# --- Example: Local Dev (default — just copy .env.example to .env) ---
# All required vars above have sensible defaults. Run:
#   cp .env.example .env && bun install && bun dev

# --- Example: Vercel Preview ---
# Most vars are auto-injected by Marketplace integrations (Neon, Resend, Upstash).
# You only need to set manually:
#   BETTER_AUTH_SECRET=<random-32-char-string>
#   APP_URL=https://your-preview-url.vercel.app
#   CORS_ORIGIN=https://your-preview-url.vercel.app

# --- Example: VPS / Self-Hosted Production ---
# NODE_ENV=production
# WEB_PORT=3000
# PORT=4000
# APP_URL=https://app.example.com
# API_URL=https://api.example.com
# DATABASE_URL=postgresql://user:pass@clouddb:5432/roxabi
# CORS_ORIGIN=https://app.example.com
# BETTER_AUTH_SECRET=<random-32-char-string>
# BETTER_AUTH_URL=https://api.example.com
# EMAIL_FROM=noreply@example.com
# RESEND_API_KEY=re_xxxxx
# KV_REST_API_URL=https://xxx.upstash.io
# KV_REST_API_TOKEN=xxx
```

#### Edge cases

- **Existing `.env` files**: Developers who already have a `.env` are not affected. The `.env.example` changes are documentation-only.
- **Missing optional vars**: App must still start with only required vars set. No regressions.

### Task 2: Create Ubiquitous Language Document (S)

#### Happy path

1. Create `docs/architecture/ubiquitous-language.mdx`
2. Add a glossary table with all current domain terms (alphabetically ordered)
3. Add a "Common Confusions" section clarifying known ambiguities
4. Add Mermaid `stateDiagram-v2` blocks for key entity lifecycles
5. Update `docs/architecture/meta.json` to include the new page

#### Glossary content

Include these terms (verify each definition against its cited source doc before publishing):

| Term | Definition | Source |
|------|-----------|--------|
| **Invitation** | A pending org membership invite with an expiration. Requires acceptance by the invitee. | [auth-security](./auth-security) |
| **Member** | A user's membership in a specific organization. Stored in the `members` table with both a Better Auth `role` text column and an RBAC `role_id` FK. | [rbac](./rbac) |
| **Organization** | A Better Auth entity representing a group of users. Maps to a row in the `organizations` table. | [multi-tenant](./multi-tenant) |
| **Permission** | A `resource:action` string (e.g., `members:write`). 15 possible permissions across 5 resources and 3 actions. | [rbac](./rbac) |
| **Role** | A named set of permissions scoped to an organization. Four defaults: Owner, Admin, Member, Viewer. Custom roles are also supported. | [rbac](./rbac) |
| **Session** | An authenticated session tracking the user and their active organization via `sessions.active_organization_id`. | [multi-tenant](./multi-tenant) |
| **Tenant** | The logical data isolation boundary. Currently 1:1 with Organization (each org is a root tenant). | [multi-tenant](./multi-tenant) |
| **Tenant Context** | The resolved `tenant_id` propagated from the HTTP session through CLS into PostgreSQL RLS policies. | [multi-tenant](./multi-tenant) |
| **User** | An authenticated individual with a `users` table row. Can belong to multiple organizations. | [auth-security](./auth-security) |

#### Common Confusions section

- **Tenant vs Organization**: Organization is the Better Auth entity. Tenant is the logical isolation boundary. Currently 1:1, but the architecture supports parent-org hierarchies where a parent org is the tenant boundary for its children.
- **Member (entity) vs Member (role)**: The `members` table stores org membership (the entity). The "Member" role is one of four default RBAC roles. A user has a Member entity in each org they belong to, but their role within that org could be Owner, Admin, Member, or Viewer.
- **Better Auth `role` vs RBAC `role_id`**: The `members` table has both. The Better Auth `role` is a text string for Better Auth's internal use. The `role_id` FK links to the RBAC roles table for fine-grained permission checks.

#### State machine diagrams (Mermaid)

Three diagrams using `stateDiagram-v2`:

1. **Invitation lifecycle**: `pending` → `accepted` | `expired` | `revoked`
2. **Session lifecycle**: `created` → `active` → `org_switched` → `expired`
3. **Member lifecycle**: `invited` → `active` → `removed`

These should be verified against the actual codebase behavior (check the invitation, session, and member module code).

#### Edge cases

- **Future terms**: The glossary scopes to the current model. New terms are added as features ship. Include a note at the top: "This glossary covers the current domain model. It is extended as new features are implemented."
- **Term drift**: If an architecture doc is updated but the glossary is not, the two can diverge. Add a note to `docs/contributing.mdx` that architecture doc changes should trigger a glossary review.

### Task 3: Add Demo GIF to README (S)

#### Preconditions

- `bun dev` must be running at `APP_URL` (default: `http://localhost:3000`)
- Database must be seeded with representative data: at least 2 organizations, multiple members with different roles
- Playwright and `ffmpeg` must be installed (Playwright for browser automation, `ffmpeg` for video-to-GIF conversion)

#### Happy path

1. Create a Playwright recording script at `scripts/record-demo.ts`
2. The script connects to the running local app, uses Playwright's built-in video recording (`{ video: 'on' }`) to capture a `.webm` file
3. Convert the `.webm` to an optimized GIF or MP4 using `ffmpeg`
4. Save the output to `docs/assets/demo.gif` (or `demo.mp4`)
5. Update `README.md` to embed the visual at the top (after title, before Stack table)
6. Add re-recording instructions to `docs/contributing.mdx`

#### Playwright script behavior

```
1. Navigate to APP_URL (landing page) → pause 2s
2. Click "Sign up" / "Get Started" → pause 1s
3. Fill signup form → submit → pause 2s
4. Dashboard loads → pause 2s
5. Open org switcher → pause 1s
6. Switch org → pause 2s
7. (Optional) Show role management or another key feature
```

The script should be runnable with:
```bash
bun run scripts/record-demo.ts
```

**Recommended approach:** Use Playwright's `{ video: 'on' }` context option to record a `.webm`, then convert with `ffmpeg -i recording.webm -vf "fps=10,scale=1280:-1" docs/assets/demo.gif && gifsicle --optimize=3 --colors=128 docs/assets/demo.gif -o docs/assets/demo.gif`. Keep the recording short (5-7 seconds, focus on 3-4 key frames) to stay under 5MB. GitHub only renders GIFs inline in README — MP4 does not work.

**Dependencies to install:** `@playwright/test` (dev dependency at monorepo root). `ffmpeg` is a system binary — document installation in the re-recording instructions.

#### README placement

```markdown
# Roxabi Boilerplate

SaaS boilerplate with AI team integration.

![Roxabi Boilerplate demo — signup, dashboard, and multi-tenant organization switching](docs/assets/demo.gif)

## Stack
...
```

#### Edge cases

- **App not running**: The script should check if the app is running and provide a clear error if not, rather than failing with a cryptic Playwright timeout
- **Seed data missing**: The script needs representative data (users, orgs, roles). If the seed script does not produce this, document what manual setup is needed or enhance the seed script
- **CI**: The recording script is NOT run in CI. It is a developer tool run manually when the GIF needs updating.
- **File size**: Keep recording short (5-7s) at 10fps with `gifsicle` optimization to stay under 5MB. If still too large, reduce resolution or trim frames. GitHub does not render MP4 inline in README.

### Task 4: Migrate ASCII Diagrams to Mermaid (S)

#### Happy path

1. Identify all `` ```txt `` code blocks containing ASCII diagrams across `docs/`
2. Convert each to the appropriate Mermaid diagram type (`flowchart`, `sequenceDiagram`, `stateDiagram-v2`, `graph`, etc.)
3. Replace the `` ```txt `` block with a `` ```mermaid `` block
4. Verify each converted diagram renders correctly in Fumadocs

#### Scope

Primary targets (6 architecture docs, ~25 `txt` blocks):

| File | Approx. diagrams |
|------|-----------------|
| `docs/architecture/frontend.mdx` | 9 |
| `docs/architecture/ci-cd.mdx` | 5 |
| `docs/architecture/rbac.mdx` | 4 |
| `docs/architecture/index.mdx` | 3 |
| `docs/architecture/auth-security.mdx` | 2 |
| `docs/architecture/multi-tenant.mdx` | 2 |

**Not in scope:** ASCII diagrams in analyses, specs, or other docs outside `docs/architecture/`. These can be migrated in a follow-up if desired.

#### Edge cases

- **Complex ASCII art**: Some diagrams may not map cleanly to Mermaid's syntax (e.g., deeply nested tree structures). In these cases, keep the ASCII version and add a comment `<!-- TODO: migrate to Mermaid when syntax supports this layout -->`
- **Semantic changes**: Conversion must preserve the exact same information. Do not simplify or change the diagram content during migration.
- **Existing mermaid blocks**: `docs/analyses/00-infrastructure-setup-summary.mdx` already has a Mermaid block. Leave existing Mermaid blocks untouched.

## Constraints

- **Task 0 must complete before Tasks 2 and 4** — Mermaid support is a prerequisite for the ubiquitous language diagrams and the ASCII migration
- **Task 3 depends on seed data** — The Playwright script needs representative users, orgs, and roles in the local database. The current seed script does not create multiple organizations — this must be enhanced as a prerequisite sub-task.
- **No application logic changes** — No new API endpoints, UI components, or database migrations. Tasks modify documentation, configuration (`source.config.ts`), and developer scripts (`scripts/record-demo.ts`).
- **Fumadocs build memory** — The Mermaid plugin must not cause OOM issues during Vercel builds (see [#234](https://github.com/MickaelV0/roxabi_boilerplate/issues/234))
- **#234 coordination** — If spec #234 (Shiki language restriction) ships before or alongside this, ensure `mermaid` is excluded from `rehypeCodeOptions.langs` so Shiki does not interfere with Mermaid rendering

## Non-goals

- **Comparison table in README** — Intentionally dropped from scope (see analysis). Issue #226 AC should be updated.
- **Application logic changes** — No API endpoints, UI components, or database migrations are modified
- **Full docs overhaul** — Only the specific improvements listed. Broader docs quality work is out of scope.
- **ASCII migration outside architecture docs** — Only `docs/architecture/` is in scope. Other docs can be migrated later.

## Technical Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Mermaid rendering approach | Client-side (`mermaid` + `remarkMdxMermaid` + `next-themes`) | [Fumadocs-recommended approach](https://www.fumadocs.dev/docs/markdown/mermaid). Native dark mode, no headless browser, compatible with `async: true`. ~200KB client bundle tradeoff. |
| Mermaid plugin config location | `defineConfig({ mdxOptions: { remarkPlugins: [remarkMdxMermaid] } })` in `source.config.ts` | Standard Fumadocs MDX plugin hook. `remarkMdxMermaid` from `fumadocs-core/mdx-plugins`. |
| Demo visual format | GIF (only format GitHub renders inline in README) | GitHub does NOT render MP4 inline in README files. GIF is the only option for inline visuals. Keep recording short (5-7s) at 10fps with `gifsicle` optimization. |
| Demo recording method | Playwright script with built-in video recording | Automated, reproducible, easy to re-run. Uses Playwright's `{ video: 'on' }` → `ffmpeg` → GIF conversion. |
| Demo hosting | In-repo at `docs/assets/demo.gif` | Versioned with the code, no external dependency. |
| Glossary location | `docs/architecture/ubiquitous-language.mdx` | Architecture-scoped, consistent with other architecture docs |
| Glossary ordering | Alphabetical | Standard for glossaries, enables quick lookup |
| ASCII migration scope | Architecture docs only (~25 diagrams in 6 files) | Highest impact, most visible. Other docs can follow later. |

## Success Criteria

- [ ] Mermaid code blocks render as diagrams in Fumadocs, legible in both light and dark mode
- [ ] `.env.example` has clear section headers, required/optional markers, inline comments, and 3 worked examples
- [ ] `docs/architecture/ubiquitous-language.mdx` exists with glossary table, common confusions, and 3 Mermaid state diagrams
- [ ] README contains a demo GIF or MP4 video showing the app in action
- [ ] `scripts/record-demo.ts` exists and produces the demo visual when run
- [ ] Re-recording instructions documented in `docs/contributing.mdx`
- [ ] Glossary review note added to `docs/contributing.mdx` (architecture doc changes should trigger glossary review)
- [ ] All ~25 ASCII diagrams in `docs/architecture/` are converted to Mermaid (or have TODO comments for unconvertible ones)
- [ ] Each converted diagram visually confirmed in local Fumadocs dev server (`bun dev` in `apps/web`) to render the same structural information as the original ASCII art
- [ ] CI passes (`bun build` succeeds) and `bun dev` starts without errors

## Implementation Risks

- **GIF file size**: A long recording at high resolution can exceed 5MB easily. Mitigate by keeping the flow to 5-7 seconds, using 10fps, and optimizing with `gifsicle`. If still too large, reduce resolution to 960px wide or trim to fewer key frames.
- **Seed data**: The current seed script does not create multiple organizations. A seed enhancement sub-task is needed before the demo GIF can be recorded. This blocks Task 3 but not Tasks 0, 1, 2, or 4.
