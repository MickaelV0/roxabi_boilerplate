---
title: "i18n (Internationalization)"
description: "Specification for multi-language support in the Roxabi boilerplate"
---

> **Deprecated**: This document is outdated and kept for historical reference only. Please refer to the main documentation sections for current information.

## Context

i18n is listed as a core feature in the Phase 1 MVP of the boilerplate. The goal is to provide a solid infrastructure for supporting multiple languages in SaaS applications built with Roxabi.

## Objective

Implement a comprehensive internationalization system that enables:
- Translating all UI strings
- Detecting and persisting language preference
- Formatting dates, numbers, and currencies according to locale
- Full SSR support with no content flash

## Users and Use Cases

### Users
- **Developers** using the boilerplate to build SaaS products
- **End users** of applications built with Roxabi

### Use Cases
1. A visitor arrives on the site, their language is detected automatically (browser)
2. The user changes language via a switcher
3. The preference is persisted (cookie for anonymous users, profile for authenticated users)
4. All UI strings, dates, and numbers are displayed in the correct locale

## Technical Decisions

### Chosen Stack

| Aspect | Choice | Justification |
|--------|--------|---------------|
| Library | **i18next** + react-i18next | Mature ecosystem, excellent SSR support, large community |
| File format | **JSON namespaces** | Lazy loading per route, clear organization, good splitting |
| Plurals | **i18next standard** | Sufficient for EN/FR, simple syntax |
| Formatting | **Native Intl API** | Standard, lightweight, no external dependency |
| SSR | **Full SSR** | Zero flash, better SEO, optimal UX |

### Language Detection

```
1. URL path (/fr/..., /en/...)
2. Cookie (if already set)
3. Accept-Language header (browser)
4. Fallback: English
```

### Persistence

| User | Storage |
|------|---------|
| Anonymous | `locale` cookie (1 year) |
| Authenticated | `locale` field in user profile + cookie sync |

### File Structure

```
apps/web/
├── locales/
│   ├── en/
│   │   ├── common.json      # Shared strings (buttons, errors...)
│   │   ├── auth.json        # Login, register, password...
│   │   ├── dashboard.json   # Dashboard specific
│   │   └── settings.json    # Settings page
│   └── fr/
│       ├── common.json
│       ├── auth.json
│       ├── dashboard.json
│       └── settings.json
├── lib/
│   └── i18n/
│       ├── index.ts         # i18next configuration
│       ├── server.ts        # SSR utilities
│       ├── client.ts        # Client initialization
│       └── types.ts         # TypeScript types
└── components/
    └── LanguageSwitcher.tsx # Hook + minimal UI example
```

### Translation Format

```json
// locales/en/common.json
{
  "buttons": {
    "submit": "Submit",
    "cancel": "Cancel",
    "save": "Save changes"
  },
  "errors": {
    "required": "This field is required",
    "invalid_email": "Please enter a valid email"
  },
  "items": "{{count}} item",
  "items_plural": "{{count}} items"
}
```

### TanStack Start Integration

```tsx
// Route with SSR i18n
export const Route = createFileRoute('/dashboard')({
  loader: async ({ context }) => {
    // Load dashboard namespace on the server
    await context.i18n.loadNamespaces(['dashboard'])
    return { /* data */ }
  },
  component: Dashboard,
})
```

## Expected Behavior

### Happy Path

1. Request arrives at `/fr/dashboard`
2. Server detects locale `fr` from the URL
3. Loads the required namespaces (`common`, `dashboard`)
4. Renders HTML with FR translations
5. Client hydrates with the same i18n state
6. No flash, optimal SEO

### Edge Cases

| Case | Behavior |
|------|----------|
| Unknown locale in URL | Redirect to default locale (EN) |
| Missing translation key | Displays `[missing: key.name]` in dev, falls back to EN in prod |
| Language change | Update cookie + reload page (for correct SSR) |
| Authenticated user changes language | Update DB profile + cookie + reload |

## Constraints

### Technical
- TanStack Start with SSR (Vinxi)
- Bun runtime
- No RTL for v1

### Scope v1
- Languages: English (default), French
- UI strings only (no DB content)
- No external translator workflow

## Non-Goals

- RTL support (Arabic, Hebrew)
- Database content translation
- Translation platform integration (Crowdin, Lokalise)
- Support for &gt;2 languages in v1

## DX (Developer Experience)

### Missing Keys in Development

```tsx
// In dev mode, displays:
// - Console warning: "Missing translation key: dashboard.welcome"
// - Visual: [missing: dashboard.welcome] in the UI
```

### CI Validation Script

```bash
# scripts/validate-translations.ts
# Verifies that all locales have the same keys
bun run scripts/validate-translations.ts
```

Integrated into CI to block PRs with missing keys.

### Formatting Helpers

```tsx
import { useLocale } from '@/lib/i18n'

function PriceDisplay({ amount }: { amount: number }) {
  const { formatCurrency, formatDate, formatNumber } = useLocale()

  return (
    <div>
      <span>{formatCurrency(amount, 'EUR')}</span>
      <span>{formatDate(new Date())}</span>
      <span>{formatNumber(1234.56)}</span>
    </div>
  )
}
```

## Success Criteria

- [ ] i18next configured with full SSR (zero flash)
- [ ] Automatic language detection (URL > cookie > browser > EN)
- [ ] Cookie + user profile persistence
- [ ] Namespace structure with lazy loading
- [ ] Working `useTranslation` hook
- [ ] `useLocale` hook with formatters (date, number, currency)
- [ ] Minimal LanguageSwitcher component
- [ ] CI key validation script
- [ ] Translation workflow documentation
- [ ] Unit tests for i18n logic

## Open Questions

- Should all namespaces be preloaded or lazy loaded per route? (To be validated with benchmarks)
- Exact URL format: `/fr/dashboard` vs `/dashboard?lang=fr` (leaning toward path-based for SEO)

## References

- [i18next documentation](https://www.i18next.com/)
- [react-i18next](https://react.i18next.com/)
- [TanStack Start SSR](https://tanstack.com/start/latest)
