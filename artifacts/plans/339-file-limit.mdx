---
title: 'Plan: Enforce 500-line file limit'
issue: 339
complexity: 6/10
tier: F-lite
generated: 2026-02-24T00:00:00Z
---

## Summary

Add Biome `noExcessiveLinesPerFile` nursery rule (500 lines, error), refactor 10 source files exceeding the limit, and add a pre-push hook to enforce the constraint going forward.

## Agents

| Agent | Tasks | Files |
|-------|-------|-------|
| devops | 4 | biome.json, lefthook.yml, .claude/skills (2 files) |
| frontend-dev (×2) | 6 | packages/ui, apps/web routes + components |
| backend-dev | 2 | apps/api service + scripts |
| tester | 1 | Verification pass |

## Consistency Report

- Covered: 4/4 acceptance criteria
- Uncovered: none
- Untraced: none
- Exemptions: 0

## Micro-Tasks

### Slice V1: Configuration

#### Task 1: Add noExcessiveLinesPerFile rule to biome.json → devops
- **File:** biome.json
- **Verify:** `bun run lint 2>&1 | grep -q 'noExcessiveLinesPerFile' || echo 'rule active'` (ready)
- **Time:** 3 min | **Difficulty:** 1
- **Traces:** AC-1 | **Phase:** GREEN

#### Task 2: Add file-length check to pre-push hook → devops
- **File:** lefthook.yml
- **Verify:** `grep -q 'file-length' ../roxabi-339/lefthook.yml` (ready)
- **Time:** 5 min | **Difficulty:** 2
- **Traces:** AC-3 | **Phase:** GREEN

### Slice V2: Frontend refactoring

#### Task 3: Split presets.ts (994 lines) [P] → frontend-dev
- **File:** packages/ui/src/themes/presets.ts
- **Verify:** `wc -l < ../roxabi-339/packages/ui/src/themes/presets.ts` ≤ 500 (ready)
- **Time:** 8 min | **Difficulty:** 3
- **Traces:** AC-2 | **Phase:** GREEN

#### Task 4: Split design-system/index.tsx (980 lines) [P] → frontend-dev
- **File:** apps/web/src/routes/design-system/index.tsx
- **Verify:** `wc -l` ≤ 500 (ready)
- **Time:** 8 min | **Difficulty:** 3
- **Traces:** AC-2 | **Phase:** GREEN

#### Task 5: Split login.tsx (636 lines) [P] → frontend-dev
- **File:** apps/web/src/routes/login.tsx
- **Verify:** `wc -l` ≤ 500 (ready)
- **Time:** 5 min | **Difficulty:** 2
- **Traces:** AC-2 | **Phase:** GREEN

#### Task 6: Split organizations.tsx (603 lines) [P] → frontend-dev
- **File:** apps/web/src/routes/admin/organizations.tsx
- **Verify:** `wc -l` ≤ 500 (ready)
- **Time:** 5 min | **Difficulty:** 2
- **Traces:** AC-2 | **Phase:** GREEN

#### Task 7: Split ThemeEditor.tsx (589 lines) [P] → frontend-dev
- **File:** apps/web/src/routes/design-system/-components/ThemeEditor.tsx
- **Verify:** `wc -l` ≤ 500 (ready)
- **Time:** 5 min | **Difficulty:** 2
- **Traces:** AC-2 | **Phase:** GREEN

#### Task 8: Split account.tsx (571 lines) [P] → frontend-dev
- **File:** apps/web/src/routes/settings/account.tsx
- **Verify:** `wc -l` ≤ 500 (ready)
- **Time:** 5 min | **Difficulty:** 2
- **Traces:** AC-2 | **Phase:** GREEN

### Slice V3: Backend refactoring

#### Task 9: Split admin-organizations.service.ts (615 lines) [P] → backend-dev
- **File:** apps/api/src/admin/admin-organizations.service.ts
- **Verify:** `wc -l` ≤ 500 (ready)
- **Time:** 5 min | **Difficulty:** 3
- **Traces:** AC-2 | **Phase:** GREEN

#### Task 10: Split db-branch.ts (731 lines) [P] → backend-dev
- **File:** apps/api/scripts/db-branch.ts
- **Verify:** `wc -l` ≤ 500 (ready)
- **Time:** 5 min | **Difficulty:** 3
- **Traces:** AC-2 | **Phase:** GREEN

### Slice V4: Tooling refactoring

#### Task 11: Split analyze-findings.ts (791 lines) [P] → devops
- **File:** .claude/skills/retro/scripts/analyze-findings.ts
- **Verify:** `wc -l` ≤ 500 (ready)
- **Time:** 5 min | **Difficulty:** 2
- **Traces:** AC-2 | **Phase:** GREEN

#### Task 12: Split page.ts (551 lines) [P] → devops
- **File:** .claude/skills/issues/lib/page.ts
- **Verify:** `wc -l` ≤ 500 (ready)
- **Time:** 5 min | **Difficulty:** 2
- **Traces:** AC-2 | **Phase:** GREEN

### Slice V5: Verification

#### Task 13: Full quality gate → tester
- **Verify:** `bun lint && bun typecheck && bun run test` (ready)
- **Time:** 10 min | **Difficulty:** 2
- **Traces:** AC-4 | **Phase:** GREEN
