---
title: 'Plan: Phase 1 Practical Standards'
issue: 316
spec: artifacts/specs/316-practical-standards.mdx
complexity: 4
tier: F-full
generated: '2026-02-26T00:00:00Z'
---

## Summary

Extend three existing standards docs (`frontend-patterns.mdx`, `backend-patterns.mdx`, `testing.mdx`) with TanStack Query patterns, SOLID principles, and testing improvements. Docs-only — no code changes. Three parallel doc-writer agents write S1/S2/S3, then a finalize step renumbers AI Quick Reference sections.

## Bootstrap Context

From `artifacts/analyses/316-practical-standards.mdx`: Shape 1 (Extend Existing Docs) selected. TanStack Query is largest gap (14 files use `useQuery`, zero `queryOptions()` factories). Testing gap is narrower than expected (`testing.mdx` already covers Testing Trophy). SOLID is documenting existing implicit patterns. All three docs share consistent style: hierarchical numbering, code examples, rules, AI Quick Reference.

## Agents

| Agent | Task count | Files |
|-------|-----------|-------|
| doc-writer-1 (TanStack Query) | 7 | `docs/standards/frontend-patterns.mdx` |
| doc-writer-2 (SOLID) | 5 | `docs/standards/frontend-patterns.mdx`, `docs/standards/backend-patterns.mdx` |
| doc-writer-3 (Testing) | 5 | `docs/standards/testing.mdx` |
| lead (Finalize) | 2 | `docs/standards/frontend-patterns.mdx`, `docs/standards/backend-patterns.mdx` |

## Consistency Report

- Criteria covered: 22/22
- Uncovered criteria: none
- Tasks without spec backing: none
- Gold plating exemptions applied: 0

## Reference Patterns

Agents must read the target file before writing to match existing style. Key conventions:
- `frontend-patterns.mdx`: numbered sections (1.1-1.6), `###` subsections, TypeScript/TSX code blocks, Rules bullet lists
- `backend-patterns.mdx`: numbered sections (1.1-1.5), NestJS decorator examples, anti-pattern sections
- `testing.mdx`: unnumbered `##` headings, walkthrough examples, Vitest code blocks

## Micro-Tasks

### Slice S1: TanStack Query (#260)

Ref: spec affordances F1-F6. Target: `docs/standards/frontend-patterns.mdx`. Agent: doc-writer.

Context to inject: Read `apps/web/src/lib/useOrganizations.ts`, `apps/web/src/hooks/useCursorPagination.ts`, `apps/web/src/routes/admin/members.tsx`, `apps/web/src/routes/admin/feature-flags.tsx`, `apps/web/src/router.tsx` for existing patterns. Read `docs/standards/frontend-patterns.mdx` for style conventions. Read spec at `artifacts/specs/316-practical-standards.mdx` for full requirements.

#### Task 1: Write queryOptions() factory section (1.7.1) [P] → doc-writer

- **File:** `docs/standards/frontend-patterns.mdx`
- **Snippet:** New `### 1.7.1 queryOptions() Factory` section after new `## 1.7 TanStack Query Patterns` heading. Before/after code example using `useOrganizations.ts` as reference.
- **Verify:** `grep -q '### 1.7.1' docs/standards/frontend-patterns.mdx` (ready)
- **Expected:** Section exists with queryOptions factory pattern
- **Time:** 5 min | **Difficulty:** 3
- **Traces:** SC-S1-1, SC-S1-2, F1 | **Phase:** GREEN

#### Task 2: Write query key convention section (1.7.2) [P] → doc-writer

- **File:** `docs/standards/frontend-patterns.mdx`
- **Snippet:** New `### 1.7.2 Query Key Convention` section. Hierarchical key factory pattern `queryKeys.domain.action(params)`. Reference `FEATURE_FLAGS_QUERY_KEY`.
- **Verify:** `grep -q 'queryKeys\.' docs/standards/frontend-patterns.mdx` (ready)
- **Expected:** Key factory pattern documented
- **Time:** 4 min | **Difficulty:** 2
- **Traces:** SC-S1-3, F2 | **Phase:** GREEN

#### Task 3: Write route-level prefetching section (1.7.3) [P] → doc-writer

- **File:** `docs/standards/frontend-patterns.mdx`
- **Snippet:** New `### 1.7.3 Route-Level Prefetching` section. `beforeLoad` + `ensureQueryData` example. Guard-then-prefetch ordering. Note `setupRouterSsrQueryIntegration` already configured.
- **Verify:** `grep -q 'ensureQueryData' docs/standards/frontend-patterns.mdx` (ready)
- **Expected:** Prefetch pattern with guard ordering documented
- **Time:** 5 min | **Difficulty:** 3
- **Traces:** SC-S1-4, F3 | **Phase:** GREEN

#### Task 4: Write cache strategy section (1.7.4) [P] → doc-writer

- **File:** `docs/standards/frontend-patterns.mdx`
- **Snippet:** New `### 1.7.4 Cache Strategy` section. `staleTime` defaults, broad vs targeted `invalidateQueries`, when to use `setQueryData`. Document `useQuery` as default, `useSuspenseQuery` for Suspense boundaries.
- **Verify:** `grep -q 'useSuspenseQuery' docs/standards/frontend-patterns.mdx` (ready)
- **Expected:** Cache strategy and useQuery/useSuspenseQuery decision documented
- **Time:** 5 min | **Difficulty:** 3
- **Traces:** SC-S1-5, F4 | **Phase:** GREEN

#### Task 5: Write mutation patterns section (1.7.5) [P] → doc-writer

- **File:** `docs/standards/frontend-patterns.mdx`
- **Snippet:** New `### 1.7.5 Mutation Patterns` section. Canonical `useMutation` + `invalidateQueries`. Optimistic update example with `setQueryData`.
- **Verify:** `grep -q 'setQueryData' docs/standards/frontend-patterns.mdx` (ready)
- **Expected:** Mutation pattern with optimistic update example
- **Time:** 5 min | **Difficulty:** 3
- **Traces:** SC-S1-6, F5 | **Phase:** GREEN

#### Task 6: Write rules + anti-patterns section (1.7.6) [P] → doc-writer

- **File:** `docs/standards/frontend-patterns.mdx`
- **Snippet:** New `### 1.7.6 Rules` section. Bullet list: always queryOptions(), never hardcode keys, always invalidate, prefer useQuery unless Suspense boundary, etc.
- **Verify:** `grep -q '### 1.7.6' docs/standards/frontend-patterns.mdx` (ready)
- **Expected:** Rules bullet list exists
- **Time:** 3 min | **Difficulty:** 1
- **Traces:** SC-CC-1, F6 | **Phase:** GREEN

#### Task 7: Verify S1 completeness → doc-writer

- **File:** `docs/standards/frontend-patterns.mdx`
- **Snippet:** Review sections 1.7.1-1.7.6 for consistency, cross-references, and style match with existing sections.
- **Verify:** `grep -c '### 1.7.' docs/standards/frontend-patterns.mdx` (ready)
- **Expected:** 6 (subsections 1.7.1-1.7.6)
- **Time:** 3 min | **Difficulty:** 1
- **Traces:** SC-CC-1, SC-CC-3 | **Phase:** REFACTOR

### Slice S2: SOLID (#258)

Ref: spec affordances F7, B1-B8. Target: `docs/standards/frontend-patterns.mdx` (section 1.8), `docs/standards/backend-patterns.mdx` (section 1.6). Agent: doc-writer.

Context to inject: Read `apps/api/src/auth/auth.service.ts`, `apps/api/src/rbac/permission.service.ts`, `apps/api/src/common/filters/allExceptions.filter.ts`, `apps/api/src/auth/auth.guard.ts`, `apps/api/src/auth/auth.module.ts` for backend SOLID examples. Read `apps/web/src/routes/settings/profile.tsx`, `apps/web/src/routes/dashboard.tsx` for frontend SOLID examples. Read both standards docs for style conventions. Read spec at `artifacts/specs/316-practical-standards.mdx`.

#### Task 8: Write frontend SOLID section (1.8) [P] → doc-writer

- **File:** `docs/standards/frontend-patterns.mdx`
- **Snippet:** New `## 1.8 SOLID Principles — Frontend` section after 1.7. Cover SRP, OCP, ISP, DIP with 1 code example each. LSP acknowledged as N/A (one sentence).
- **Verify:** `grep -q '## 1.8 SOLID' docs/standards/frontend-patterns.mdx` (ready)
- **Expected:** SOLID frontend section with 4 principles + LSP acknowledgment
- **Time:** 8 min | **Difficulty:** 4
- **Traces:** SC-S2-1, SC-S2-2, F7 | **Phase:** GREEN

#### Task 9: Write backend SOLID intro + SRP/OCP sections (1.6.1-1.6.2) [P] → doc-writer

- **File:** `docs/standards/backend-patterns.mdx`
- **Snippet:** New `## 1.6 SOLID Principles — Backend` section after 1.5. Subsections 1.6.1 SRP (AuthService, PermissionService examples, god-service anti-pattern) and 1.6.2 OCP (`@Catch()` extension, Reflector guards, `AllExceptionsFilter` gap note).
- **Verify:** `grep -q '### 1.6.2' docs/standards/backend-patterns.mdx` (ready)
- **Expected:** SRP and OCP subsections with codebase examples and gap notes
- **Time:** 8 min | **Difficulty:** 4
- **Traces:** SC-S2-3, SC-S2-4, SC-S2-5, B1, B2, B3 | **Phase:** GREEN

#### Task 10: Write backend LSP/ISP/DIP sections (1.6.3-1.6.5) → doc-writer

- **File:** `docs/standards/backend-patterns.mdx`
- **Snippet:** Subsections 1.6.3 LSP (domain exceptions, composition pattern), 1.6.4 ISP (lean DI tokens, focused methods), 1.6.5 DIP (`@Inject(TOKEN)`, `forwardRef`, raw Drizzle gap note).
- **Verify:** `grep -q '### 1.6.5' docs/standards/backend-patterns.mdx` (ready)
- **Expected:** LSP, ISP, DIP subsections with examples and gap notes
- **Time:** 8 min | **Difficulty:** 4
- **Traces:** SC-S2-4, SC-S2-5, B4, B5, B6 | **Phase:** GREEN

#### Task 11: Write backend SOLID rules section (1.6.6) → doc-writer

- **File:** `docs/standards/backend-patterns.mdx`
- **Snippet:** New `### 1.6.6 Rules` subsection. SOLID-specific rules consolidated. Anti-patterns list.
- **Verify:** `grep -q '### 1.6.6' docs/standards/backend-patterns.mdx` (ready)
- **Expected:** SOLID rules bullet list
- **Time:** 3 min | **Difficulty:** 1
- **Traces:** SC-CC-1, B7 | **Phase:** GREEN

#### Task 12: Verify S2 completeness → doc-writer

- **File:** `docs/standards/frontend-patterns.mdx`, `docs/standards/backend-patterns.mdx`
- **Snippet:** Review 1.8 (frontend) and 1.6 (backend) for consistency, gap notes, cross-references to existing sections (e.g., B6 → 1.4 Provider Patterns).
- **Verify:** `grep -q '1.4 Provider' docs/standards/backend-patterns.mdx` (manual)
- **Expected:** Cross-references present where applicable
- **Time:** 3 min | **Difficulty:** 1
- **Traces:** SC-CC-2 | **Phase:** REFACTOR

### Slice S3: Testing (#261)

Ref: spec affordances T1-T5. Target: `docs/standards/testing.mdx`. Agent: doc-writer.

Context to inject: Read `docs/standards/testing.mdx` for style conventions. Read `apps/web/src/test/setup.ts`, `apps/web/src/test/__mocks__/mockSession.ts`, `apps/api/src/admin/__test-utils__/createChainMock.ts`, `apps/web/src/lib/apiClient.test.ts` for existing test patterns. Read spec at `artifacts/specs/316-practical-standards.mdx`.

#### Task 13: Write testing layer guidance section [P] → doc-writer

- **File:** `docs/standards/testing.mdx`
- **Snippet:** New `## Testing Layer Guidance` section after "Testing Philosophy — The Testing Trophy" and before "Red-Green-Refactor Cycle". Decision table: when unit / integration / E2E. Complements Trophy section.
- **Verify:** `grep -q '## Testing Layer Guidance' docs/standards/testing.mdx` (ready)
- **Expected:** Section with decision criteria table
- **Time:** 5 min | **Difficulty:** 3
- **Traces:** SC-S3-1, T1 | **Phase:** GREEN

#### Task 14: Write MSW adoption section [P] → doc-writer

- **File:** `docs/standards/testing.mdx`
- **Snippet:** New `## MSW Adoption` section after "Mocking Strategies" Rules (~line 291), before "Test Data Management". Includes: why MSW > vi.spyOn(fetch), `bun add -d msw` installation note, setup guide, before/after comparison. Handler patterns as `###` subsection.
- **Verify:** `grep -q 'bun add -d msw' docs/standards/testing.mdx` (ready)
- **Expected:** MSW section with installation command and handler examples
- **Time:** 8 min | **Difficulty:** 4
- **Traces:** SC-S3-2, SC-S3-3, T2, T3 | **Phase:** GREEN

#### Task 15: Write TanStack Query testing subsection [P] → doc-writer

- **File:** `docs/standards/testing.mdx`
- **Snippet:** New `### TanStack Query Testing` subsection under "Frontend Testing Patterns" (after "Utility Testing" ~line 207). `QueryClientProvider` wrapper setup, testing `queryOptions()` factories, mutation testing. Cross-reference `frontend-patterns.mdx` section 1.7. Reference existing `createMockSession` factories.
- **Verify:** `grep -q 'QueryClientProvider' docs/standards/testing.mdx` (ready)
- **Expected:** TanStack Query testing section with wrapper setup and cross-reference
- **Time:** 5 min | **Difficulty:** 3
- **Traces:** SC-S3-4, SC-S3-5, SC-S3-6, T4 | **Phase:** GREEN

#### Task 16: Update existing mocking rules + add TQ testing rules → doc-writer

- **File:** `docs/standards/testing.mdx`
- **Snippet:** Extend `### Rules` within "Mocking Strategies" (~line 283) with MSW-specific rules. Add `### Rules` to TanStack Query Testing subsection.
- **Verify:** `grep -q 'MSW' docs/standards/testing.mdx` (ready)
- **Expected:** MSW and TQ rules added
- **Time:** 3 min | **Difficulty:** 1
- **Traces:** SC-CC-1, T5 | **Phase:** GREEN

#### Task 17: Verify S3 completeness → doc-writer

- **File:** `docs/standards/testing.mdx`
- **Snippet:** Review all new sections for consistency with existing unnumbered heading style, no duplication with existing Mocking Strategies/Coverage Guidelines content.
- **Verify:** `grep -c '## ' docs/standards/testing.mdx` (manual)
- **Expected:** Heading count increased, no duplication
- **Time:** 3 min | **Difficulty:** 1
- **Traces:** SC-CC-1, SC-CC-3 | **Phase:** REFACTOR

### Slice S4: Finalize (depends on S1, S2, S3)

Ref: spec affordances F8, B8. Target: both `frontend-patterns.mdx` and `backend-patterns.mdx`. Agent: lead (orchestrator).

#### Task 18: Renumber frontend AI Quick Reference 1.7 → 1.9 + add rules → lead

- **File:** `docs/standards/frontend-patterns.mdx`
- **Snippet:** Change `## 1.7 AI Quick Reference` → `## 1.9 AI Quick Reference`. Add compressed TanStack Query rules and SOLID rules from S1/S2 content.
- **Verify:** `grep -q '## 1.9 AI Quick Reference' docs/standards/frontend-patterns.mdx` (ready)
- **Expected:** Renumbered to 1.9 with new compressed rules
- **Time:** 5 min | **Difficulty:** 2
- **Traces:** SC-S4-1, F8 | **Phase:** REFACTOR

#### Task 19: Renumber backend AI Quick Reference 1.6 → 1.7 + add rules → lead

- **File:** `docs/standards/backend-patterns.mdx`
- **Snippet:** Change `## 1.6 AI Quick Reference` → `## 1.7 AI Quick Reference`. Add compressed SOLID rules from S2 content.
- **Verify:** `grep -q '## 1.7 AI Quick Reference' docs/standards/backend-patterns.mdx` (ready)
- **Expected:** Renumbered to 1.7 with new compressed rules
- **Time:** 3 min | **Difficulty:** 1
- **Traces:** SC-S4-2, B8 | **Phase:** REFACTOR
