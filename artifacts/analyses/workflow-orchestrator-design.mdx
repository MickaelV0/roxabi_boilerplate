---
title: Workflow Orchestrator — Atomic Skills Architecture
issue: 364
status: approved
date: 2026-02-26
type: analysis
---

## Summary

Replace monolithic `/bootstrap` + `/scaffold` + manual chaining with:
- **Atomic step skills** — each does ONE thing, produces ONE artifact
- **`/dev` orchestrator** — single entry point, artifact-based state detection, skip logic

Architecture: **2-level** (Orchestrator → Step skills). No phase-level middlemen.

---

## Artifact Model

Three artifact types form the Shape phase pipeline. Each answers a distinct question:

| Artifact | Question | Focus | Analogy |
|----------|----------|-------|---------|
| **Frame** (`artifacts/frames/`) | What's the problem? | Problem space: who, why, constraints, boundaries. **Not solutions.** | Photograph |
| **Analysis** (`artifacts/analyses/`) | How deep is it? | Technical exploration: existing code, dependencies, risks, alternatives. **Not design.** | X-ray |
| **Spec** (`artifacts/specs/`) | What will we build? | Solution design: acceptance criteria, APIs, data models, tasks. **Buildable blueprint.** | Blueprint |

Additionally:
- **Plan** (`artifacts/plans/`) — Implementation breakdown: task list, agent assignments, file groups. Answers "how do we build it?"

---

## Phase Model

```
Frame   →   Shape   →   Build    →   Verify   →   Ship
─────       ─────       ─────        ──────       ────
triage      frame       plan         validate      promote
            analyze?    implement    review        cleanup
            spec        pr           fix
```

---

## Step Skills Inventory

### New skills to create

| Skill | Responsibility | Artifact produced | Extracted from |
|-------|---------------|-------------------|----------------|
| `/frame` | Problem framing: problem, who, constraints, out of scope, complexity tier | `artifacts/frames/{slug}.mdx` | NEW |
| `/analyze` | Deep technical analysis with expert review | `artifacts/analyses/{N}-{slug}.mdx` | `/bootstrap` gate 1 |
| `/spec` | Solution spec with expert review | `artifacts/specs/{N}-{slug}.mdx` | `/bootstrap` gate 2 |
| `/plan` | Implementation plan: scope, tasks, agents, file groups | `artifacts/plans/{N}-{slug}.mdx` | `/scaffold` phases 1-4 |
| `/implement` | Execute plan: setup worktree, spawn agents, write code + tests | Code + tests in worktree | `/scaffold` phases 5-6 |
| `/fix` | Apply review findings one by one | Modified files | `/review` auto-apply + 1b1 |
| `/dev` | Orchestrator: state detection, skip logic, delegation | Progress state (implicit via artifacts) | NEW |

All step skills are **user-invocable** — can be called directly or via `/dev`.

### Existing skills (keep as-is)

| Skill | Phase | Notes |
|-------|-------|-------|
| `/issue-triage` | Frame | Invoked as "triage" step by orchestrator |
| `/interview` | Frame | Optional, orchestrator decides based on complexity |
| `/pr` | Build | Already atomic |
| `/validate` | Verify | Already atomic |
| `/review` | Verify | Simplified: remove auto-apply + 1b1 (now `/fix` + `/1b1`) |
| `/1b1` | Verify | Already atomic, called by `/fix` |
| `/promote` | Ship | Already atomic |
| `/cleanup` | Ship | Already atomic |
| `/test` | Build | Standalone, also called by `/implement` |

### Deprecated (aliases → /dev)

| Skill | Redirects to |
|-------|-------------|
| `/bootstrap` | `/dev` (starts at Shape phase) |
| `/scaffold` | `/dev` (starts at Build phase) |

---

## Artifact-Based State Machine

The orchestrator infers current phase by checking what artifacts exist.
All checks run in parallel (~3s total).

```
Check                            Artifact / Signal                    Phase.Step
──────────────────────────────────────────────────────────────────────────────────
GitHub issue exists?             gh issue view #N                     Frame.triage
Frame doc exists?                artifacts/frames/{slug}.mdx          Frame.frame
  └─ status: approved?          frontmatter field                    (gate)
Analysis exists? (optional)      artifacts/analyses/{N}-{slug}.mdx   Shape.analyze
Spec exists?                     artifacts/specs/{N}-{slug}.mdx      Shape.spec
Plan exists?                     artifacts/plans/{N}-{slug}.mdx      Build.plan
Worktree + branch exists?        git worktree list + git branch       Build.implement
PR exists?                       gh pr list --head {branch}           Build.pr
Validate passing?                Re-run /validate                     Verify.validate
Review done?                     PR review state via gh               Verify.review
Fixes applied?                   No open findings                     Verify.fix
PR merged?                       gh pr view --json merged             Ship.promote
Branches cleaned?                No stale branches                    Ship.cleanup
All present                      —                                    done ✓
```

### First missing artifact = next step

The orchestrator walks the chain top-to-bottom. The **first missing artifact** determines the next step.

---

## Skip Logic

| Condition | Step skipped | Reason |
|-----------|-------------|--------|
| Tier = S | frame, analyze, spec, plan | Straight to implement (≤3 files, no arch) |
| Frame thorough + tier ≤ F-lite | analyze | Frame captures enough context |
| Tier = F-full | nothing skipped | Full pipeline required |
| Review has 0 findings | fix | Nothing to fix |
| Single commit, no release | promote | Just merge PR directly |

### Tier detection (auto-detect + confirm)

1. Read frame doc `tier` frontmatter field
2. Fall back to GitHub issue `size` label
3. If ambiguous → AskUserQuestion to confirm

---

## Orchestrator UX

### Entry point

```
/dev #42
```

### Status display (on every loop)

```
## Dark Mode (#42)  [F-lite]

  Frame    ██████████  ✓ triage, frame (approved)
  Shape    ████░░░░░░    analyze skipped, spec pending
  Build    ░░░░░░░░░░    —
  Verify   ░░░░░░░░░░    —
  Ship     ░░░░░░░░░░    —

→ Next: spec (generate spec from frame)
```

Then AskUserQuestion:
- **Continue** — run next step
- **Skip to…** — jump to a specific step (with warning if dependencies missing)
- **Stop** — pause here, resume later with `/dev #42` again

### Gates (pause for approval)

| Gate | When | What happens |
|------|------|-------------|
| Frame approval | After `/frame` writes doc | User reviews problem statement, approves or revises |
| Spec approval | After `/spec` writes doc | User reviews solution design, approves or revises |
| PR review | After `/review` posts findings | User decides to fix, skip, or merge |

### Resume

`/dev #42` always works — re-scans artifacts and picks up where it left off.
No state file needed. Artifacts ARE the state.

---

## Orchestrator Internal Flow

```
1. Parse input → issue #N
2. Fetch issue metadata (title, labels, assignee)
3. Parallel scan:
   - glob artifacts/frames/*
   - glob artifacts/analyses/*
   - glob artifacts/specs/*
   - glob artifacts/plans/*
   - gh pr list
   - git worktree list
4. Match artifacts to issue (by number or slug)
5. Determine tier (from frame/issue/ask)
6. Apply skip logic
7. Compute next step
8. Display progress + next step
9. AskUserQuestion: Continue / Skip to... / Stop
10. On Continue → invoke step skill with context
11. On step completion → goto 3 (re-scan)
12. On Stop → exit (state persists via artifacts)
```

---

## Frame Artifact Format

```mdx
---
title: Dark Mode
issue: 42
status: draft | approved
tier: S | F-lite | F-full
date: 2026-02-26
---

## Problem
Users report eye strain during nighttime use.

## Who
All users, especially mobile.

## Constraints
- Must respect system preference
- No flash of wrong theme on load
- Existing color tokens must be preserved

## Out of scope
- Custom theme builder
- Per-component theme overrides

## Complexity
F-lite: single domain (frontend), clear scope, ~8 files.
```

---

## Implementation Order

1. **`/dev`** — orchestrator (core loop, state detection, progress display)
2. **`/frame`** — new framing skill
3. **`/analyze`** — extract from `/bootstrap` gate 1
4. **`/spec`** — extract from `/bootstrap` gate 2
5. **`/plan`** — extract from `/scaffold` phases 1-4
6. **`/implement`** — extract from `/scaffold` phases 5-6
7. **`/fix`** — extract from `/review` auto-apply
8. **Simplify `/review`** — remove auto-apply + 1b1 (now delegated)
9. **Alias `/bootstrap`** + **`/scaffold`** → redirect to `/dev`
10. **Update CLAUDE.md** — new workflow, new artifact definitions
11. **Update dev-process.mdx** — align process doc with new phases

---

## Migration

- Keep `/bootstrap` and `/scaffold` as aliases that redirect to `/dev` at the appropriate phase
- All existing artifacts (analyses, specs, plans) remain valid — new system reads them
- Remove aliases after transition period (no usage for 2+ weeks)
