---
title: "Audit Auto-Capture Interceptor"
parent_spec: "artifacts/specs/371-observability-stack.mdx"
parent_issue: 371
---

## Scope

Phase 4 â€” NestJS interceptor for automatic audit log capture on decorated mutation endpoints. Breadboard IDs: N11, N12, N13.

## Success Criteria

- [ ] `@AuditLog({ action, resource: { type, idParam } })` decorator available for controller handlers
- [ ] `AuditInterceptor` reads entity before/after handler, logs diff to `audit_logs`
- [ ] Pre-read fails (entity not found): interceptor logs `before: null` and proceeds
- [ ] Handler throws: interceptor does not write audit entry
- [ ] 4 production call sites migrated from manual `auditService.log()` to `@AuditLog()` decorator
- [ ] ~9 test assertions updated for interceptor behavior
- [ ] No double-logging: manual calls removed after migration
- [ ] Auto-captured entries visible in existing admin audit log UI
- [ ] Interceptor uses `actorId` from CLS context

## Reference

Full spec: [artifacts/specs/371-observability-stack.mdx](../specs/371-observability-stack.mdx)
