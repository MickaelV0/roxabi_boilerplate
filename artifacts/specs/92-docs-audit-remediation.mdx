---
title: "Fix Stale Docs and Add Missing Guides"
description: "Remediate documentation findings M-20 to M-25 from the 2026-02-09 project audit — fix 2 stale docs and create 2 new guides."
status: deprecated
---

> **Deprecated** — Audit remediation work completed. Superseded by the 2026-02-13 documentation audit.

## Context

The [2026-02-09 project audit](../analyses/project-audit-2026-02-09) identified six documentation findings (M-20 through M-25). Two have already been fixed (M-20 JWT_SECRET, M-21 Swagger URL) in commit `67c8894`. Four remain open.

**Promoted from:** [Documentation Audit Remediation Analysis](../analyses/92-docs-audit-remediation)

## Goal

Close all remaining documentation findings from the audit:
- Align `contributing.mdx` branch naming and priority labels with their source-of-truth documents
- Create reference-level guides for database architecture and authentication

## Users &amp; Use Cases

**Developers onboarding to the project** — read contributing.mdx for workflow conventions, database.mdx to understand the data layer, authentication.mdx to understand the auth system.

**AI agents** — use documentation as context for code generation and decision-making. Stale docs cause incorrect assumptions.

## Expected Behavior

### Happy path

#### Task 1: Fix branch naming in contributing.mdx (M-24)

Replace the branch naming table at `contributing.mdx:18-24`.

**Before:**

```
| Type | Pattern | Example |
|------|---------|---------|
| Feature | `feature/<issue-id>-<description>` | `feature/42-user-auth` |
| Bug fix | `fix/<issue-id>-<description>` | `fix/15-login-timeout` |
| Hotfix | `hotfix/<issue-id>-<description>` | `hotfix/99-security-patch` |
| Docs | `docs/<description>` | `docs/api-reference` |
```

**After** (aligned with `dev-process.mdx:230`):

```
| Type | Pattern | Example |
|------|---------|---------|
| Feature | `feat/<issue-id>-<slug>` | `feat/42-user-auth` |
| Bug fix | `fix/<issue-id>-<slug>` | `fix/15-login-timeout` |
| Hotfix | `hotfix/<issue-id>-<slug>` | `hotfix/99-security-patch` |
| Docs | `docs/<slug>` | `docs/api-reference` |
```

#### Task 2: Align priority labels (M-25)

**2a. Fix `contributing.mdx:169-173`**

Replace the Priority table:

**Before:**

```
| Label | Description |
|-------|-------------|
| `P1` | Critical - fix immediately |
| `P2` | High - current sprint |
| `P3` | Medium - next sprint |
```

**After** (aligned with `issue-management.mdx:49-54`):

```
| Label | Description |
|-------|-------------|
| `P0` | Urgent — blocking or critical, do immediately |
| `P1` | High — important for current milestone |
| `P2` | Medium — should be done soon |
| `P3` | Low — nice to have, backlog |
```

**2b. Fix `issue-management.mdx:130-134`**

The "Labels" section at line 130 has a duplicate priority table that conflicts with the primary table at line 49. Replace:

**Before:**

```
| Label | Description |
|-------|-------------|
| `P1` | Critical — fix immediately |
| `P2` | High — current sprint |
| `P3` | Medium — next sprint |
```

**After:**

```
| Label | Description |
|-------|-------------|
| `P0` | Urgent — blocking or critical |
| `P1` | High — current milestone |
| `P2` | Medium — plan soon |
| `P3` | Low — nice to have |
```

#### Task 3: Create database architecture guide (M-22)

Create `docs/architecture/database.mdx`. Standalone, reference-level. Content sections:

1. **Overview** — Drizzle ORM with PostgreSQL via `postgres.js` driver
2. **Provider pattern** — `DRIZZLE` and `POSTGRES_CLIENT` Symbol injection tokens, nullable in dev / throw in prod, global `DatabaseModule`, connection pooling config (`max: 10`, `idle_timeout: 20`, `connect_timeout: 10`)
3. **Schema conventions** — shared `timestamps` helper (`created_at`, `updated_at` with timezone + `$onUpdateFn`), `tenantColumn` helper for RLS, `text` primary keys with UUID generation, snake_case column names, plural table names
4. **Auth schema** — Better Auth manages 6 tables: `users`, `sessions`, `accounts`, `verifications`, `organizations`, `members`, `invitations`. Defined in `auth.schema.ts` via Drizzle adapter (`usePlural: true`)
5. **Drizzle Kit config** — schema at `./src/database/schema/index.ts`, migrations at `./drizzle/migrations`, `strict: true`, `verbose: true`
6. **Migration workflow** — `bunx drizzle-kit generate` to create migrations, `bunx drizzle-kit migrate` to apply, `bunx drizzle-kit studio` for visual inspection
7. **Adding a new table** — step-by-step: create schema file, re-export from `index.ts`, generate migration, apply

Update `docs/architecture/meta.json` to add `"database"` to the `pages` array.

#### Task 4: Create authentication guide (M-23)

Create `docs/guides/authentication.mdx`. Standalone, reference-level. Content sections:

1. **Overview** — Better Auth with Drizzle adapter, email+password, OAuth (Google, GitHub), magic link, organization &amp; admin plugins
2. **Architecture** — two-layer design: `auth.instance.ts` (Better Auth config, pure function) + `auth.service.ts` (NestJS wrapper, injectable). `AuthModule` registers both and sets global guard.
3. **Auth guard** — global deny-by-default via `APP_GUARD`. Decorators to modify behavior:
   - `@Public()` → skip auth entirely (sets `PUBLIC` metadata)
   - `@OptionalAuth()` → allow unauthenticated but attach session if present (`OPTIONAL_AUTH`)
   - `@Roles('admin')` → require specific role (`ROLES`)
   - `@RequireOrg()` → require active organization (`REQUIRE_ORG`)
   - `@Session()` parameter decorator → extract session from request
4. **Session management** — cookie-based, 7-day expiry, daily refresh (`updateAge`), 5-minute cookie cache. Frontend uses Vite proxy (`/api/*` → `localhost:3001`) to keep cookies same-origin.
5. **Email provider** — `EMAIL_PROVIDER` injection token, `ResendEmailProvider` as default implementation. Sends verification, password reset, and magic link emails.
6. **Frontend client** — `createAuthClient` from `better-auth/react` with `organizationClient`, `adminClient`, `magicLinkClient` plugins. Exports `useSession`, `signIn`, `signUp`, `signOut`.
7. **Environment variables** — `BETTER_AUTH_SECRET` (required, 32+ chars), OAuth client ID/secret pairs (optional, conditionally enabled)

Update `docs/guides/meta.json` to add `"authentication"` to the `pages` array.

### Edge cases

| Scenario | Handling |
|----------|----------|
| `meta.json` already contains the new entry | Skip the update (idempotent) |
| New guide references code that changes later | Guides describe current state; they get updated in future PRs |
| `issue-management.mdx` primary table (line 49) already correct | Only fix the duplicate table at line 130 |

## Constraints

- All documents must use `.mdx` format with YAML frontmatter
- Escape `&lt;` as `&amp;lt;` in MDX content
- New guides are **standalone** — no cross-links to other analyses or specs
- Guides must reflect the **current codebase** (not aspirational patterns)

## Non-goals

- Fixing other audit findings (C-1 to C-8, other M-* or L-* items)
- Rewriting existing docs that are already correct
- Creating docs not listed in the audit (README, troubleshooting, etc.)
- Adding cross-links or navigation from new guides to existing artifacts/analyses/specs

## Technical Decisions

| Decision | Rationale |
|----------|-----------|
| `feat/` not `feature/` for branch prefix | `dev-process.mdx` is authoritative; code, CLAUDE.md, and worktree commands all use `feat/` |
| P0-P3 scale from `issue-management.mdx:49-54` | This is the primary definition; the section at line 130 and `contributing.mdx` are duplicates that drifted |
| Standalone guides | User preference — simpler to maintain, no broken links if referenced docs change |
| Reference-level depth | Covers what exists today with enough detail to onboard. Not comprehensive architecture docs |

## Success Criteria

- [ ] `contributing.mdx` branch naming uses `feat/` prefix (aligned with `dev-process.mdx`)
- [ ] `contributing.mdx` priority labels use P0-P3 scale (aligned with `issue-management.mdx`)
- [ ] `issue-management.mdx` duplicate priority table at line 130 matches primary table at line 49
- [ ] `docs/architecture/database.mdx` exists with all 7 content sections
- [ ] `docs/guides/authentication.mdx` exists with all 7 content sections
- [ ] `docs/architecture/meta.json` includes `"database"`
- [ ] `docs/guides/meta.json` includes `"authentication"`
- [ ] All MDX files pass frontmatter validation (title + description)
- [ ] `bun typecheck` passes (no broken imports)

## Open Questions

None — all decisions are resolved.
