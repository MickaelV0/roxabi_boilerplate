---
issue: 388
title: "docs: documentation accuracy audit â€” fix outdated and missing content"
tier: F-lite
status: approved
date: 2026-02-26
source: issue-body (audit performed 2026-02-26, no frame/analysis artifact)
---

# Spec: Documentation Accuracy Audit Fixes (#388)

## Context

A full documentation audit was performed on 2026-02-26 by four domain agents (frontend, backend,
devops, architect). The audit identified 30+ specific inaccuracies across 20+ doc files â€” ranging
from security-critical (missing `SET LOCAL ROLE` in RLS examples) to minor typos. All findings are
documented in [issue #388](https://github.com/roxabi/roxabi_boilerplate/issues/388).

No code changes are required. All fixes are documentation-only (`.mdx`, `.md`, `CLAUDE.md`,
`AGENTS.md`).

## Goal

All documentation accurately reflects the current codebase â€” every code snippet, command, file
path, and architectural description matches what actually exists in the repo.

## Users

- **Developers** onboarding to the project who rely on docs for patterns
- **Contributors** following coding standards docs
- **Operators** following deployment and configuration docs
- **AI agents** using CLAUDE.md and AGENTS.md as grounding instructions

## Expected Behavior

A developer reading any doc in `docs/` or any `CLAUDE.md`/`AGENTS.md` file will:
1. Find commands that work exactly as written
2. Find file paths that exist
3. Find code examples that match the actual codebase patterns
4. Not encounter descriptions of features that are not yet implemented (without a clear "Planned" callout)
5. Not follow patterns that would introduce security vulnerabilities (e.g., missing `SET LOCAL ROLE`)

For patterns that are the target standard but not yet universally applied (e.g., `queryOptions`
factory in `frontend-patterns.mdx`), they are clearly framed as "Target Pattern" with known
migration debt explicitly noted â€” distinguishing current state from intended target.

## Breadboard

N/A â€” documentation fixes only. No UI affordances or API endpoints to wire.

## Slices

Grouped by domain for parallel delegation. Each slice is independently deliverable.

| # | Slice | Files | Priority |
|---|-------|-------|----------|
| 1 | **Backend docs** | `docs/standards/backend-patterns.mdx`, `docs/architecture/auth-security.mdx`, `docs/architecture/rbac.mdx`, `docs/architecture/multi-tenant.mdx`, `docs/guides/rbac.mdx`, `docs/architecture/database.mdx`, `docs/architecture/ubiquitous-language.mdx` | ðŸ”´ High |
| 2 | **DevOps docs** | `docs/architecture/ci-cd.mdx`, `docs/hooks.mdx`, `docs/guides/i18n.mdx`, `docs/configuration.mdx`, `docs/guides/deployment.mdx`, `docs/getting-started.mdx`, `docs/contributing.mdx`, `docs/guides/security.mdx` | ðŸ”´ High |
| 3 | **Architecture & process docs** | `docs/guides/agent-teams.mdx`, `docs/architecture/index.mdx`, `docs/product/vision.mdx`, `docs/product/persona-gtm.mdx`, `AGENTS.md`, `docs/processes/dev-process.mdx` | ðŸ”´ High |
| 4 | **Frontend docs** | `docs/standards/frontend-patterns.mdx`, `docs/architecture/frontend.mdx`, `docs/guides/authentication.mdx`, `docs/guides/navigation-guards.mdx`, `apps/web/CLAUDE.md` | ðŸ”´ High |

All slices can be executed in parallel.

## Success Criteria

### Cross-domain

- [ ] `DATABASE_APP_URL` is documented in `configuration.mdx` (Database section + Vercel API table)
- [ ] `DATABASE_APP_URL` is documented in `deployment.mdx` (API project provisioning section)
- [ ] `DATABASE_APP_URL` is documented in `getting-started.mdx` (database setup step)
- [ ] Agent count reads **9** (not 10) in `vision.mdx` (lines 92 and 259)
- [ ] Agent count reads **9** (not 10) in `persona-gtm.mdx`

### Backend â€” High priority

- [ ] `database.mdx`: `SET LOCAL ROLE app_user` added to `DrizzleProvider` description with explanation that RLS requires the role switch before `set_config`
- [ ] `multi-tenant.mdx`: production code section shows `SET LOCAL ROLE app_user` before `set_config` (consistent with the testing section that already has it)
- [ ] `auth-security.mdx`: `SET LOCAL ROLE app_user` mentioned in the RLS enforcement description
- [ ] `backend-patterns.mdx`: soft-delete guard step documented in `AuthGuard` evaluation order (step between session validation and role checks; `SOFT_DELETED_ALLOWED_ROUTES` allowlist noted)
- [ ] `auth-security.mdx`: soft-delete check included in `AuthGuard.canActivate()` flowchart
- [ ] `rbac.mdx`: soft-delete step present in guard evaluation flowchart
- [ ] `rbac.mdx`: `PATCH /api/roles/members/:id/role` marked as deprecated with note pointing to `PATCH /api/admin/members/:memberId`
- [ ] `guides/rbac.mdx`: "Changing a Member's Role" section uses `PATCH /api/admin/members/:memberId` (or has a clear deprecation notice with the replacement)
- [ ] `multi-tenant.mdx`: "Organization Hierarchy and Tenant Boundaries" section marked as **Planned / not yet implemented** (`resolveParentOrg()` is a no-op returning `orgId` directly, pending Phase 3)

### Backend â€” Medium priority

- [ ] `database.mdx`: `DatabaseModule.onModuleInit()` documents the `checkCoreTables()` step (verifies Better Auth core tables exist)
- [ ] `database.mdx`: migration table reference updated to `drizzle.__drizzle_migrations` (schema-qualified)
- [ ] `database.mdx`: `DrizzleProvider` description notes that `DATABASE_APP_URL` is preferred over `DATABASE_URL` and explains the RLS rationale (app user = RLS enforced; schema owner = RLS bypassed)
- [ ] `auth-security.mdx`: `@SkipOrg()` decorator added to the decorator table with description: "Skip tenant context resolution in `TenantInterceptor`; used for endpoints that do not require org context"
- [ ] `rbac.mdx`: `@SkipOrg()` decorator added to the decorator/annotation reference table
- [ ] `rbac.mdx`: permission count consistently reads **17** (`api_keys:delete` is confirmed NOT seeded in `rbac.constants.ts`; the type system allows 18 combinations but only 17 are used)
- [ ] `guides/rbac.mdx`: permission count updated to **17**
- [ ] `ubiquitous-language.mdx`: permission count updated to **17**
- [ ] `multi-tenant.mdx`: `TenantInterceptor` example includes `@SkipOrg()` Reflector short-circuit check and org soft-delete enforcement (`enforceDeletedOrgRestriction()`), or adds a clearly marked note listing these omitted behaviors
- [ ] `backend-patterns.mdx`: `AuthGuard` constructor example includes `@Inject(forwardRef(() => UserService)) private readonly userService: UserService`
- [ ] `multi-tenant.mdx`: migration filename corrected from `0000_rls_infrastructure.sql` to `0000_baseline.sql` (two locations: description and Key Files table)

### DevOps â€” High priority

- [ ] `ci-cd.mdx`: workflow count updated from "two" to "five"; table includes `pr-title.yml`, `auto-merge.yml`, `neon-cleanup.yml` with descriptions
- [ ] `ci-cd.mdx`: E2E matrix strategy documented (2-shard, chromium+firefox+webkit, `e2e-matrix` job, `merge-reports` aggregator job)
- [ ] `i18n.mdx`: Paraglide strategy updated to `['cookie', 'preferredLanguage', 'url', 'baseLocale']`

### DevOps â€” Medium priority

- [ ] `ci-cd.mdx`: YAML snippet uses `actions/cache@v5`
- [ ] `ci-cd.mdx`: `ci-success` aggregator job documented (acts as single required status check for branch protection)
- [ ] `ci-cd.mdx`: `env:check` step listed in the Lint job description
- [ ] `configuration.mdx`: TurboRepo task listing includes `clean` and `license:check`
- [ ] `hooks.mdx`: Claude Code hook JSON snippets for Biome show a simplified readable version with a note that the actual `settings.json` command adds a `case` file-type guard, `timeout 10s`, and `2>/dev/null || true` for robustness
- [ ] `hooks.mdx`: `bun test` blocker documented as a new `### Bun Test Blocker` subsection in the Claude Code hooks section, alongside `### Biome Auto-Format` and `### Security Check`
- [ ] `getting-started.mdx`: `bun run test:coverage` (not `bun test:coverage`)
- [ ] `contributing.mdx`: commit types table includes `build` and `revert`
- [ ] `security.mdx`: Gitleaks note clarifies scanning is gated by `detect-changes` on PRs (not "every PR")

### Architecture / Process â€” High priority

- [ ] `agent-teams.mdx`: Model Tiering section updated â€” states that 6 agents explicitly set `model: sonnet` (backend-dev, devops, doc-writer, fixer, frontend-dev, tester) and 3 inherit (architect, product-lead, security-auditor); removes or corrects "not applied yet" claim
- [ ] `agent-teams.mdx`: broken Mermaid diagram fixed â€” `FFScaffold` â†’ `FFAgents` on the dangling reference line
- [ ] `agent-teams.mdx`: plugins section lists all 11 enabled plugins from `.claude/settings.json` (or explicitly notes they are omitted with a link to `settings.json`)

### Architecture / Process â€” Medium priority

- [ ] `architecture/index.mdx`: packages tree includes `email`, `vitest-config`, `playwright-config`
- [ ] `architecture/index.mdx`: artifacts tree includes `frames/`; `.claude` tree includes `agent-memory/`
- [ ] `vision.mdx`: packages tree includes `email`, `vitest-config`, `playwright-config`
- [ ] `vision.mdx`: runtime agents section and Marketplace skills section marked as **Planned**
- [ ] `AGENTS.md`: maxTurns range corrected to "30â€“50" (verify against `.claude/agents/*.md` frontmatter â€” actual values are 30 and 50)
- [ ] `docs/processes/dev-process.mdx`: numbering gap fixed in Tier F steps section (step 10 is missing)

### Frontend â€” High priority

- [ ] `frontend-patterns.mdx` Â§1.7: `queryOptions` factory pattern framed as **Target Pattern** (required standard, migration in progress); current inline `useQuery` + standalone constant shown as **Current Pattern**; prescriptive rules in summary table (e.g., "Always: wrap in `queryOptions()` factory") updated to read as "Target: wrap in `queryOptions()` factory" to avoid internal contradiction
- [ ] `frontend-patterns.mdx` Â§1.7: non-existent factory files (`apps/web/src/lib/featureFlags/queries.ts`, `queryKeys.ts`) removed from examples; examples updated to reflect actual inline `useQuery` pattern in `feature-flags.tsx`
- [ ] `architecture/frontend.mdx`: demo references removed â€” `demo.FormComponents.tsx`, `demo-store.ts`, `src/data/` section, TanStack Store section (these files no longer exist)
- [ ] `architecture/frontend.mdx`: devtools section updated to show 2 plugins (not 3); TanStack Store Devtools plugin entry removed
- [ ] `authentication.mdx`: import alias changed from `~/lib/authClient` to `@/lib/authClient`

### Frontend â€” Medium priority

- [ ] `architecture/frontend.mdx`: `DocsErrorBoundary.tsx` casing corrected (was `docs-error-boundary.tsx`)
- [ ] `navigation-guards.mdx`: route inventory includes `/magic-link/verify`, `/magic-link-sent`, `/talks/dev-process` in the public pages table
- [ ] `apps/web/CLAUDE.md`: messages path corrected (`apps/web/messages/` not `project.inlang/messages/`)
- [ ] `apps/web/CLAUDE.md`: `admin/` component directory added to the component directory listing
- [ ] `frontend-patterns.mdx` Â§1.7: note added that `feature-flags.tsx` has known migration debt â€” uses direct `fetch` in event handler (violates Â§1.7.6 anti-pattern rule) and inline `useQuery` (pre-migration state), pending migration to `useMutation` + `queryOptions` factory

## Out of Scope

- **ADR skill `meta.json` format mismatch**: The `/adr` skill expects a JSON array `{number, title, status, date, file}` but `docs/architecture/adr/meta.json` uses the Fumadocs nav format `{title, pages[]}`. This requires a skill code change, not a doc edit â€” tracked as a follow-up.
- **Code changes**: No application code changes. If the audit reveals that code should be improved (e.g., migrate `feature-flags.tsx` to use `useMutation`), those are separate issues.
- **New documentation**: This spec covers only fixes to existing docs, not new doc pages.
- **Root `CLAUDE.md`**: The audit confirmed no inaccuracies in root `CLAUDE.md` â€” excluded from all slices.
