---
title: "Feature Flags Admin Page + Backend with Cache"
parent_spec: "artifacts/specs/270-admin-phase3-system-settings-feature-flags.mdx"
parent_issue: 270
---

## Scope

Slice V3: Feature flags admin controller (full CRUD), frontend page, cache invalidation, audit logging.

- `AdminFeatureFlagsController` (`GET`, `POST`, `PATCH`, `DELETE` for `/api/admin/feature-flags`)
- Frontend `/admin/feature-flags` page with toggle switches, create dialog, delete confirmation
- Empty state for zero flags ("Create your first flag to get started")
- `flag-list-item.tsx`, `create-flag-dialog.tsx` components
- Key validation (`/^[a-z0-9][a-z0-9_-]*$/`, max 100 chars, unique, immutable after creation)
- `PATCH` accepts `{ enabled?, name?, description? }` â€” key is not accepted
- Cache invalidation on toggle/delete (write-through, cache keyed by flag `key`)
- Audit logging (`flag.created`, `flag.toggled`, `flag.deleted` actions)
- Enable "Feature Flags" sidebar nav item
- Exception types: `FlagNotFoundException`, `FlagKeyConflictException`, `FlagKeyInvalidException`

## Success Criteria

- [ ] `GET /api/admin/feature-flags` returns all flags ordered by `createdAt DESC`
- [ ] `POST /api/admin/feature-flags` creates a flag. Duplicate key returns 400. Invalid key format returns 400
- [ ] `PATCH /api/admin/feature-flags/:id` accepts `{ enabled?, name?, description? }`. Key is immutable (not accepted in payload)
- [ ] `DELETE /api/admin/feature-flags/:id` removes flag and cache entry with audit log
- [ ] `/admin/feature-flags` shows empty state when no flags exist
- [ ] Toggle switch immediately invalidates cache entry on the handling instance
- [ ] Delete confirmation dialog displays warning about `false` safe-default behavior
- [ ] "Feature Flags" sidebar nav item enabled and visible to super admins only
- [ ] All endpoints use `@Roles('superadmin')` with `@SkipOrg()`
- [ ] All mutations produce audit log entries with correct action vocabulary

## Reference

Full spec: [artifacts/specs/270-admin-phase3-system-settings-feature-flags.mdx](./270-admin-phase3-system-settings-feature-flags.mdx)
