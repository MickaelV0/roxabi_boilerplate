---
title: fix: code and skill gaps found during documentation audit
issue: 389
status: approved
tier: F-full
date: 2026-02-27
---

## Problem

During the documentation accuracy audit (#388), four code/skill gaps were identified as side-effects of verifying docs against the actual codebase. These are not documentation errors — they are real defects in production code and tooling that need to be addressed separately.

The most critical gap is in the `/adr` skill: it silently overwrites `docs/architecture/adr/meta.json` with an incompatible schema, breaking the Fumadocs sidebar for all ADR pages whenever the skill is used. This is a data-corruption bug that affects any developer who runs `/adr`.

The second gap is in `apps/web/src/routes/admin/feature-flags.tsx`, which violates two frontend coding standards: direct `fetch` in an event handler, and a standalone `FEATURE_FLAGS_QUERY_KEY` constant instead of a `queryOptions()` factory. The documentation audit noted this as "known migration debt" but the actual code migration was never done.

Two additional gaps exist but are being handled separately: parent org resolution (formally deferred to Phase 3) and `api_keys:delete` RBAC permission (tracked in Epic #194).

## Who

- **Primary:** Developers using the `/adr` skill — the ADR skill will silently corrupt `meta.json` on every use, breaking the docs sidebar until the file is manually restored.
- **Secondary:** Developers maintaining or reviewing `feature-flags.tsx` — the standards violation creates inconsistency and makes future migration harder.
- **Tertiary:** Future developers reading `tenant.interceptor.ts` — the unresolved TODO is misleading without an explicit deferral note.

## Constraints

- Item #1 (ADR skill): must preserve the existing `pages` array in `meta.json` and merge new ADR entries rather than overwriting the file.
- Item #2 (feature-flags.tsx): migration must follow `frontend-patterns.mdx §1.7` — `queryOptions()` factory + `useMutation` for toggle action.
- Item #3 (parent org resolution): no implementation required — formal deferral with a clear code comment and issue reference is sufficient.
- Item #4 (api_keys:delete): out of scope — tracked separately in Epic #194.
- No new dependencies should be added for any of these fixes.

## Out of Scope

- Documentation fixes for #388 (docs-only, separate PR).
- Implementing parent tenant resolution (Phase 3, formally deferred here).
- Adding `api_keys:delete` RBAC permission (Epic #194).
- Any refactoring beyond the minimum required to fix the violations.

## Complexity

**Tier: F-full** — spans three domains (skills, frontend, backend) with different patterns, requires reading standards docs before each fix, and includes an architectural decision (formal deferral of Phase 3 work).

Signals observed:
- Multiple domains: `.claude/skills/adr/`, `apps/web/`, `apps/api/`
- Standards compliance: must read `frontend-patterns.mdx` before touching `feature-flags.tsx`
- Architectural decision: explicit deferral of `resolveParentOrg()` with issue reference
- Critical severity: ADR skill causes silent data corruption
