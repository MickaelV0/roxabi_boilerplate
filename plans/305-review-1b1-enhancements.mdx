---
title: "Plan: Enhance review + 1b1 with root cause analysis, recommendations & confidence-based auto-apply"
issue: 305
spec: specs/305-review-1b1-enhancements.mdx
complexity: 4/10
tier: F-lite
generated: 2026-02-23T00:00:00Z
---

## Summary

Enrich the `/review` and `/1b1` skills with root cause analysis, concrete recommendations, confidence scoring, and a confidence-gated auto-apply phase. High-confidence findings are auto-applied by fixer agents; low-confidence findings go through an enriched 1b1 walkthrough with solution options. All changes are prompt-only modifications to 3 markdown files.

## Bootstrap Context

**From analysis (analyses/305-review-1b1-enhancements.mdx):**

Shape A selected — Enrich at review agent level. Review agents already have full context (diff, files, spec) to generate root causes and recommendations. No new pipeline stages or agents needed. 80% confidence threshold sits at the lower bound of the "high confidence" band, requiring both high diagnostic certainty and high fix certainty.

## Agents

| Agent | Task count | Files |
|-------|-----------|-------|
| doc-writer (review) | 8 | `.claude/skills/review/SKILL.md` |
| doc-writer (fixer) | 1 | `.claude/agents/fixer.md` |
| doc-writer (1b1) | 3 | `.claude/skills/1b1/SKILL.md` |

## Consistency Report

- Criteria covered: 16/16
- Uncovered criteria: none
- Tasks without spec backing: none
- Gold plating exemptions applied: 0

## Micro-Tasks

### Slice V1: Review Enrichment

#### Task 1: Add enriched finding format and confidence criteria to Phase 2 → doc-writer
- **File:** `.claude/skills/review/SKILL.md`
- **Snippet:** Add canonical enriched format (Conventional Comment + root cause + 2-3 solutions + confidence 0-100%) to Phase 2 agent instructions. Include confidence scoring criteria table and example from spec.
- **Verify:** `grep -q 'Root cause:' ../roxabi-305/.claude/skills/review/SKILL.md` (ready)
- **Expected:** Match found — enriched format is present in Phase 2 section
- **Time:** 5 min
- **Difficulty:** 3
- **Traces:** SC-1 (enriched findings), N1
- **Phase:** GREEN

#### Task 2: Add missing enrichment field default handling → doc-writer
- **File:** `.claude/skills/review/SKILL.md`
- **Snippet:** Add rule: if any enrichment field (root cause, solutions, confidence) is missing from agent output, default confidence to 0% and route to 1b1.
- **Verify:** `grep -q 'default confidence to 0%' ../roxabi-305/.claude/skills/review/SKILL.md` (ready)
- **Expected:** Match found — default handling rule present
- **Time:** 2 min
- **Difficulty:** 1
- **Traces:** SC-1 (format validation), N1
- **Phase:** GREEN

#### Task 3: Update Phase 3 merge to sort by confidence within groups → doc-writer
- **File:** `.claude/skills/review/SKILL.md`
- **Snippet:** In Phase 3, add instruction to sort findings by confidence (descending) within each category group after deduplication.
- **Verify:** `grep -q 'sort.*confidence' ../roxabi-305/.claude/skills/review/SKILL.md` (ready)
- **Expected:** Match found — sort instruction present in Phase 3
- **Time:** 2 min
- **Difficulty:** 1
- **Traces:** SC-1 (merge handling), N1
- **Phase:** GREEN

### Slice V2: Auto-Apply Gate

#### Task 4: Add Phase 3.6 confidence gate section → doc-writer
- **File:** `.claude/skills/review/SKILL.md`
- **Snippet:** Add new `### Phase 3.6 — Confidence-Gated Auto-Apply` section between Phase 3.5 and Phase 4. Split findings: ≥80% with category in [issue, suggestion, todo] → fixer batch (serial, halt on failure). <80% + non-actionable (praise, thought, question) → 1b1 queue. Failed auto-applies demoted to 1b1 with failure note. Fixer reverts via `git checkout -- <files>` before demotion.
- **Verify:** `grep -q 'Phase 3.6' ../roxabi-305/.claude/skills/review/SKILL.md` (ready)
- **Expected:** Match found — Phase 3.6 section exists
- **Time:** 8 min
- **Difficulty:** 4
- **Traces:** SC-2, SC-7, SC-8, SC-9, SC-12, N2, N6
- **Phase:** GREEN

#### Task 5: Add post-apply summary format → doc-writer
- **File:** `.claude/skills/review/SKILL.md`
- **Snippet:** Within Phase 3.6, add the post-apply summary format (matching spec format). Display after auto-apply, before 1b1 begins. Show: [applied] and [failed -> 1b1] markers with confidence percentages.
- **Verify:** `grep -q 'Auto-Applied Fixes' ../roxabi-305/.claude/skills/review/SKILL.md` (ready)
- **Expected:** Match found — post-apply summary format present
- **Time:** 3 min
- **Difficulty:** 2
- **Traces:** SC-3, N3
- **Phase:** GREEN

#### Task 6: Update Safety Rule 3 → doc-writer
- **File:** `.claude/skills/review/SKILL.md`
- **Snippet:** Replace Safety Rule 3 with authoritative text: "Human decides on every finding with estimated confidence <80%. Findings with confidence ≥80% and actionable categories (issue, suggestion, todo) are auto-applied by fixer agents, with results shown in a post-apply summary. The human can review auto-applied changes via git diff at any time."
- **Verify:** `grep -q 'estimated confidence' ../roxabi-305/.claude/skills/review/SKILL.md` (ready)
- **Expected:** Match found — updated Safety Rule 3 present
- **Time:** 2 min
- **Difficulty:** 1
- **Traces:** SC-10, N2
- **Phase:** GREEN

#### Task 7: Update Phase 3.5 to mark auto-applied findings → doc-writer
- **File:** `.claude/skills/review/SKILL.md`
- **Snippet:** In Phase 3.5 PR comment instructions, add note that all findings are included regardless of confidence. Auto-applied findings are marked with `[auto-applied]` in the PR comment.
- **Verify:** `grep -q 'auto-applied' ../roxabi-305/.claude/skills/review/SKILL.md` (ready)
- **Expected:** Match found — auto-applied marker instruction present
- **Time:** 2 min
- **Difficulty:** 1
- **Traces:** SC-11, SC-14, N2
- **Phase:** GREEN

#### Task 8: Update edge cases table → doc-writer
- **File:** `.claude/skills/review/SKILL.md`
- **Snippet:** Add new edge cases from spec: all ≥80% (skip 1b1), all <80% (skip Phase 3.6), auto-apply breaks tests (revert + demote), fixer timeout/crash (demote), praise/thought/question exemption, confidence exactly 80% (inclusive), Phase 3.6 modifies files targeted by 1b1 findings.
- **Verify:** `grep -q 'auto-apply breaks tests' ../roxabi-305/.claude/skills/review/SKILL.md` (ready)
- **Expected:** Match found — new edge cases present
- **Time:** 4 min
- **Difficulty:** 2
- **Traces:** SC-7, SC-9, N2, N6
- **Phase:** GREEN

#### Task 9: Update fixer agent for enriched format and failure signaling [P] → doc-writer
- **File:** `.claude/agents/fixer.md`
- **Snippet:** Update Fix Workflow to accept enriched findings with recommendation/chosen solution field. Use recommendation as primary fix guidance. Add failure signaling: on failure, revert changes via `git checkout -- <files>`, return "cannot auto-fix" with reason for demotion to 1b1. If recommendation is unsuitable, report rather than improvise.
- **Verify:** `grep -q 'recommendation' ../roxabi-305/.claude/agents/fixer.md` (ready)
- **Expected:** Match found — recommendation field handling present
- **Time:** 5 min
- **Difficulty:** 3
- **Traces:** SC-8, SC-16, N5, N6
- **Phase:** GREEN

### Slice V3: Enriched 1b1

#### Task 10: Update 1b1 brief template for enriched findings [P] → doc-writer
- **File:** `.claude/skills/1b1/SKILL.md`
- **Snippet:** Update the "Brief the User" section (2a) with enriched format for review findings: show label + confidence + reviewer, file path, root cause, solutions list (1-3 with recommended marker), and recommended solution with rationale. Match the enriched 1b1 brief format from spec.
- **Verify:** `grep -q 'Root cause:' ../roxabi-305/.claude/skills/1b1/SKILL.md` (ready)
- **Expected:** Match found — enriched brief format present
- **Time:** 5 min
- **Difficulty:** 3
- **Traces:** SC-4, SC-5, N4
- **Phase:** GREEN

#### Task 11: Add solution-choice follow-up question [P] → doc-writer
- **File:** `.claude/skills/1b1/SKILL.md`
- **Snippet:** In the "Ask for Decision" section (2b), when user selects "Fix now" for a review finding, add a secondary `AskUserQuestion` presenting the 2-3 solutions. Recommended solution is the first option with "(recommended)" label. Chosen solution text is stored for the fixer.
- **Verify:** `grep -q 'Solution.*recommended' ../roxabi-305/.claude/skills/1b1/SKILL.md` (ready)
- **Expected:** Match found — solution-choice follow-up present
- **Time:** 3 min
- **Difficulty:** 2
- **Traces:** SC-6, N4
- **Phase:** GREEN

#### Task 12: Update Fix execution to pass chosen solution to fixer [P] → doc-writer
- **File:** `.claude/skills/1b1/SKILL.md`
- **Snippet:** In the "Execute the Decision" section (2c), when "Fix now" is executed for a review finding, pass the chosen solution text to the fixer agent as the specific fix instruction (replacing generic "fix this finding" prompt).
- **Verify:** `grep -q 'chosen solution' ../roxabi-305/.claude/skills/1b1/SKILL.md` (ready)
- **Expected:** Match found — chosen solution handoff instruction present
- **Time:** 2 min
- **Difficulty:** 2
- **Traces:** SC-6, SC-16, N4, N5
- **Phase:** GREEN
